<!DOCTYPE html>
<html class="writer-html5" lang="en" >

<!-- Mirrored from eecs390.github.io/notes/functional.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 19 Mar 2024 18:15:41 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction to Scheme &mdash; Programming Language Principles and Paradigms 0.4 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/style-extra.css" type="text/css" />
      <link rel="stylesheet" href="_static/dark_mode_css/general.css" type="text/css" />
      <link rel="stylesheet" href="_static/dark_mode_css/dark.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery3b25.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compatfa9a.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options804b.js?v=7f00635f"></script>
        <script src="_static/doctools56c1.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight7f57.js?v=dc90522c"></script>
        <script src="_static/js-extraf31b.js?v=c32e72a1"></script>
        <script async="async" src="../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-mml-chtml.js"></script>
        <script src="_static/dark_mode_js/default_light679c.js?v=c2e647ce"></script>
        <script src="_static/dark_mode_js/theme_switcher2b7c.js?v=358d3910"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Lambda Calculus" href="theory.html" />
    <link rel="prev" title="Introduction" href="foundations.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #C53390" >

          
          
          <a href="index-2.html" class="icon icon-home">
            Programming Language Principles and Paradigms
          </a>
              <div class="version">
                0.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="https://eecs390.github.io/notes/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Foundations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="foundations.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="foundations.html#basic-python">Basic Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#variables">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#basic-data-structures">Basic Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#compound-statements">Compound Statements</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#function-definitions">Function Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#class-definitions">Class Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#modules">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#executing-a-module">Executing a Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#python-reference-semantics">Python Reference Semantics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="foundations.html#basic-elements">Basic Elements</a><ul>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#levels-of-description">Levels of Description</a><ul>
<li class="toctree-l3"><a class="reference internal" href="foundations.html#lexical-structure">Lexical Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="foundations.html#syntax">Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="foundations.html#semantics">Semantics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#entities-objects-and-variables">Entities, Objects, and Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#l-values-and-r-values">L-Values and R-Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#expressions">Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#statements">Statements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="foundations.html#names-and-environments">Names and Environments</a><ul>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#blocks">Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#name-lookup">Name Lookup</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#nested-inline-blocks">Nested Inline Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#scope-in-functions">Scope in Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#id2">Static Scope</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#dynamic-scope">Dynamic Scope</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#point-of-declaration-or-definition">Point of Declaration or Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#implementation-strategies">Implementation Strategies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="foundations.html#control-flow">Control Flow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#expression-sequencing">Expression Sequencing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="foundations.html#short-circuiting">Short Circuiting</a></li>
<li class="toctree-l3"><a class="reference internal" href="foundations.html#explicit-sequences">Explicit Sequences</a></li>
<li class="toctree-l3"><a class="reference internal" href="foundations.html#compound-assignment">Compound Assignment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#statement-sequences">Statement Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#unstructured-transfer-of-control">Unstructured Transfer of Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#structured-control">Structured Control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="foundations.html#conditionals">Conditionals</a></li>
<li class="toctree-l3"><a class="reference internal" href="foundations.html#loops">Loops</a></li>
<li class="toctree-l3"><a class="reference internal" href="foundations.html#loop-termination">Loop Termination</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#exceptions">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="foundations.html#memory-management">Memory Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#storage-duration-classes">Storage Duration Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="foundations.html#static-storage">Static Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="foundations.html#automatic-storage">Automatic Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="foundations.html#thread-local-storage">Thread-Local Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="foundations.html#dynamic-storage">Dynamic Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#value-and-reference-semantics">Value and Reference Semantics</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#raii-and-scope-based-resource-management">RAII and Scope-Based Resource Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#garbage-collection">Garbage Collection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="foundations.html#reference-counting">Reference Counting</a></li>
<li class="toctree-l3"><a class="reference internal" href="foundations.html#tracing-collectors">Tracing Collectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="foundations.html#finalizers">Finalizers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="foundations.html#grammars">Grammars</a><ul>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#regular-expressions">Regular Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#context-free-grammars">Context-Free Grammars</a></li>
<li class="toctree-l2"><a class="reference internal" href="foundations.html#grammars-in-programming-languages">Grammars in Programming Languages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="foundations.html#vexing-parse">Vexing Parse</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functional Programming</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Introduction to Scheme</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#expressions">Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#definitions">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compound-values">Compound Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="#symbolic-data">Symbolic Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#functions">Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#keyword-arguments">Keyword Arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#default-arguments">Default Arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#variadic-functions">Variadic Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parameter-passing">Parameter Passing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#evaluation-of-function-calls">Evaluation of Function Calls</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#recursion">Recursion</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#activation-records">Activation Records</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tail-recursion">Tail Recursion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#higher-order-functions">Higher-Order Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#function-objects">Function Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#functions-as-parameters">Functions as Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#function-pointers">Function Pointers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#binding-policy">Binding Policy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#nested-functions">Nested Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#decorators">Decorators</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#lambda-functions">Lambda Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#scheme">Scheme</a></li>
<li class="toctree-l2"><a class="reference internal" href="#python">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="#java">Java</a></li>
<li class="toctree-l2"><a class="reference internal" href="#c">C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="#common-patterns">Common Patterns</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sequence-patterns">Sequence Patterns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#map">Map</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reduce">Reduce</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filter">Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#any">Any</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#composition">Composition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#partial-application-and-currying">Partial Application and Currying</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#continuations">Continuations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#restricted-continuations">Restricted Continuations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#subroutines">Subroutines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exceptions">Exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generators">Generators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#first-class-continuations">First-Class Continuations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#signaling-errors">Signaling Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#call-and-return">Call and Return</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">Exceptions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Theory</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="theory.html">Lambda Calculus</a><ul>
<li class="toctree-l2"><a class="reference internal" href="theory.html#non-terminating-computation">Non-Terminating Computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#normal-order-evaluation">Normal-Order Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#encoding-data">Encoding Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theory.html#booleans">Booleans</a></li>
<li class="toctree-l3"><a class="reference internal" href="theory.html#pairs">Pairs</a></li>
<li class="toctree-l3"><a class="reference internal" href="theory.html#church-numerals">Church Numerals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#recursion">Recursion</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#equivalent-models">Equivalent Models</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theory.html#operational-semantics">Operational Semantics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="theory.html#language">Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#states-and-transitions">States and Transitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#expressions">Expressions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theory.html#arithmetic-expressions">Arithmetic Expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="theory.html#order-of-evaluation">Order of Evaluation</a></li>
<li class="toctree-l3"><a class="reference internal" href="theory.html#boolean-expressions">Boolean Expressions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#statements">Statements</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#operational-semantics-for-lambda-calculus">Operational Semantics for Lambda Calculus</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theory.html#formal-type-systems">Formal Type Systems</a><ul>
<li class="toctree-l2"><a class="reference internal" href="theory.html#variables">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#functions">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#subtyping">Subtyping</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theory.html#subtyping-and-arithmetic-operators">Subtyping and Arithmetic Operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="theory.html#the-top-type">The Top Type</a></li>
<li class="toctree-l3"><a class="reference internal" href="theory.html#subtyping-and-functions">Subtyping and Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#full-typing-rules">Full Typing Rules</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Abstraction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data.html">Functional Data Abstraction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="data.html#pairs-and-lists">Pairs and Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#message-passing">Message Passing</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#lists">Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#dictionaries">Dictionaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#dispatch-dictionaries">Dispatch Dictionaries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data.html#object-oriented-programming">Object-Oriented Programming</a><ul>
<li class="toctree-l2"><a class="reference internal" href="data.html#members">Members</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#access-control">Access Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#kinds-of-methods">Kinds of Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#nested-and-local-classes">Nested and Local Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#implementation-strategies">Implementation Strategies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data.html#inheritance-and-polymorphism">Inheritance and Polymorphism</a><ul>
<li class="toctree-l2"><a class="reference internal" href="data.html#types-of-inheritance">Types of Inheritance</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#class-hierarchies">Class Hierarchies</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#method-overriding">Method Overriding</a><ul>
<li class="toctree-l3"><a class="reference internal" href="data.html#covariance-and-contravariance">Covariance and Contravariance</a></li>
<li class="toctree-l3"><a class="reference internal" href="data.html#accessing-hidden-or-overridden-members">Accessing Hidden or Overridden Members</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="data.html#implementing-dynamic-binding">Implementing Dynamic Binding</a><ul>
<li class="toctree-l3"><a class="reference internal" href="data.html#full-lookup-and-dispatch-process">Full Lookup and Dispatch Process</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="data.html#multiple-inheritance">Multiple Inheritance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="data.html#dictionary-based-implementation">Dictionary-Based Implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="data.html#record-based-implementation">Record-Based Implementation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data.html#static-analysis">Static Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="data.html#types">Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="data.html#type-equivalence">Type Equivalence</a></li>
<li class="toctree-l3"><a class="reference internal" href="data.html#type-compatibility">Type Compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="data.html#type-inference">Type Inference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="data.html#control-flow-analysis">Control-Flow Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data.html#dynamic-typing">Dynamic Typing</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html#generics">Generics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="data.html#implicit-parametric-polymorphism">Implicit Parametric Polymorphism</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#explicit-parametric-polymorphism">Explicit Parametric Polymorphism</a><ul>
<li class="toctree-l3"><a class="reference internal" href="data.html#non-type-parameters">Non-Type Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="data.html#constraints">Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="data.html#implementation">Implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="data.html#java-generics">Java Generics</a></li>
<li class="toctree-l3"><a class="reference internal" href="data.html#curiously-recurring-template-pattern">Curiously Recurring Template Pattern</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="data.html#duck-typing">Duck Typing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data.html#modules-and-namespaces">Modules and Namespaces</a><ul>
<li class="toctree-l2"><a class="reference internal" href="data.html#translation-units">Translation Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#modules-packages-and-namespaces">Modules, Packages, and Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#linkage">Linkage</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#information-hiding">Information Hiding</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#initialization">Initialization</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Declarative Programming</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="declarative.html">Logic Programming</a><ul>
<li class="toctree-l2"><a class="reference internal" href="declarative.html#prolog">Prolog</a><ul>
<li class="toctree-l3"><a class="reference internal" href="declarative.html#lists">Lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="declarative.html#arithmetic">Arithmetic</a></li>
<li class="toctree-l3"><a class="reference internal" href="declarative.html#side-effects">Side Effects</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="declarative.html#unification-and-search">Unification and Search</a><ul>
<li class="toctree-l3"><a class="reference internal" href="declarative.html#search-order-and-backtracking">Search Order and Backtracking</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="declarative.html#the-cut-operator">The Cut Operator</a></li>
<li class="toctree-l2"><a class="reference internal" href="declarative.html#negation">Negation</a></li>
<li class="toctree-l2"><a class="reference internal" href="declarative.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="declarative.html#constraints-and-dependencies">Constraints and Dependencies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="declarative.html#constraint-logic-programming">Constraint Logic Programming</a><ul>
<li class="toctree-l3"><a class="reference internal" href="declarative.html#search">Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="declarative.html#id2">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="declarative.html#make">Make</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="declarative.html#pattern-matching">Pattern Matching</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Metaprogramming</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="metaprogramming.html">Macros and Code Generation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="metaprogramming.html#scheme-macros">Scheme Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="metaprogramming.html#cpp-macros">CPP Macros</a><ul>
<li class="toctree-l3"><a class="reference internal" href="metaprogramming.html#stringification-and-concatenation">Stringification and Concatenation</a></li>
<li class="toctree-l3"><a class="reference internal" href="metaprogramming.html#the-macro-namespace">The Macro Namespace</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="metaprogramming.html#code-generation">Code Generation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="metaprogramming.html#template-metaprogramming">Template Metaprogramming</a><ul>
<li class="toctree-l2"><a class="reference internal" href="metaprogramming.html#pairs">Pairs</a></li>
<li class="toctree-l2"><a class="reference internal" href="metaprogramming.html#numerical-computations">Numerical Computations</a></li>
<li class="toctree-l2"><a class="reference internal" href="metaprogramming.html#templates-and-function-overloading">Templates and Function Overloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="metaprogramming.html#sfinae">SFINAE</a></li>
<li class="toctree-l2"><a class="reference internal" href="metaprogramming.html#ensuring-a-substitution-failure">Ensuring a Substitution Failure</a></li>
<li class="toctree-l2"><a class="reference internal" href="metaprogramming.html#variadic-templates">Variadic Templates</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="metaprogramming.html#example-multidimensional-arrays">Example: Multidimensional Arrays</a><ul>
<li class="toctree-l2"><a class="reference internal" href="metaprogramming.html#points">Points</a></li>
<li class="toctree-l2"><a class="reference internal" href="metaprogramming.html#domains">Domains</a></li>
<li class="toctree-l2"><a class="reference internal" href="metaprogramming.html#arrays">Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="metaprogramming.html#stencil">Stencil</a></li>
<li class="toctree-l2"><a class="reference internal" href="metaprogramming.html#nested-iteration">Nested Iteration</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Concurrent Programming</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="concurrent.html">Parallel Computing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="concurrent.html#parallelism-in-python">Parallelism in Python</a><ul>
<li class="toctree-l3"><a class="reference internal" href="concurrent.html#threading">Threading</a></li>
<li class="toctree-l3"><a class="reference internal" href="concurrent.html#multiprocessing">Multiprocessing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="concurrent.html#the-problem-with-shared-state">The Problem with Shared State</a></li>
<li class="toctree-l2"><a class="reference internal" href="concurrent.html#when-no-synchronization-is-necessary">When No Synchronization is Necessary</a></li>
<li class="toctree-l2"><a class="reference internal" href="concurrent.html#synchronized-data-structures">Synchronized Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="concurrent.html#locks">Locks</a></li>
<li class="toctree-l2"><a class="reference internal" href="concurrent.html#barriers">Barriers</a></li>
<li class="toctree-l2"><a class="reference internal" href="concurrent.html#message-passing">Message Passing</a></li>
<li class="toctree-l2"><a class="reference internal" href="concurrent.html#application-examples">Application Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="concurrent.html#web-crawler">Web Crawler</a></li>
<li class="toctree-l3"><a class="reference internal" href="concurrent.html#particle-simulator">Particle Simulator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="concurrent.html#synchronization-pitfalls">Synchronization Pitfalls</a><ul>
<li class="toctree-l3"><a class="reference internal" href="concurrent.html#under-synchronization">Under-synchronization</a></li>
<li class="toctree-l3"><a class="reference internal" href="concurrent.html#over-synchronization">Over-synchronization</a></li>
<li class="toctree-l3"><a class="reference internal" href="concurrent.html#deadlock">Deadlock</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="concurrent.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="concurrent.html#asynchronous-tasks">Asynchronous Tasks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="concurrent.html#limiting-the-number-of-tasks">Limiting the Number of Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="concurrent.html#launch-policy">Launch Policy</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #C53390" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index-2.html">Programming Language Principles and Paradigms</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index-2.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Introduction to Scheme</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="foundations.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="theory.html" class="btn btn-neutral float-right" title="Lambda Calculus" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Functional Programming</h1><p>We now turn our attention to <em>procedural abstraction</em>, a strategy for
decomposing complex programs into smaller pieces of code in the form
of <em>functions</em> (also called <em>procedures</em> or <em>subroutines</em>; there are
subtle differences in how these terms are used in various contexts,
but for our purposes, we will treat them as synonyms). A function
encapsulates some computation behind an interface, and as with any
abstraction, the user of a function need only know what the function
does and not how it accomplishes it. A function also generalizes
computation by taking in arguments that affect what it computes. The
result of the computation is the function’s <em>return value</em>.</p>
<p>In this unit, we start by introducing Scheme, a functional language in
the Lisp family. We then discuss aspects of functions that are
relevant to all procedural languages before proceeding to take a
closer look at <em>functional programming</em>, a programming paradigm that
models computation after mathematical functions.</p>
<section id="introduction-to-scheme">
<h1>Introduction to Scheme<a class="headerlink" href="#introduction-to-scheme" title="Link to this heading"></a></h1>
<p>In this section, we introduce a high-level programming language that
encourages a functional style. Our object of study, the <a class="reference external" href="http://www.schemers.org/Documents/Standards/R5RS/">R5RS Scheme
language</a>, employs a very similar model of computation to Python’s,
but uses only expressions (no statements) and specializes in symbolic
computation.</p>
<p>Scheme is a dialect of <a class="reference external" href="http://en.wikipedia.org/wiki/Lisp_(programming_language)">Lisp</a>, the
second-oldest programming language that is still widely used today
(after <a class="reference external" href="http://en.wikipedia.org/wiki/Fortran">Fortran</a>). The
community of Lisp programmers has continued to thrive for decades, and
new dialects of Lisp such as <a class="reference external" href="http://en.wikipedia.org/wiki/Clojure">Clojure</a> have some of the fastest
growing communities of developers of any modern programming language.
To follow along with the examples in this text, you can download a
Scheme interpreter or use <a class="reference external" href="https://repl.it/languages/scheme">an online interpreter</a>.</p>
<section id="expressions">
<h2>Expressions<a class="headerlink" href="#expressions" title="Link to this heading"></a></h2>
<p>Scheme programs consist of expressions, which are either simple
expressions or <em>combinations</em> in the form of lists. A simple
expression consists of a literal or a symbol. A combination is a
compound expression that consists of an operator expression followed
by zero or more operand sub-expressions. Both the operator and
operands are contained within parentheses:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="n">quotient</span> <span class="mi">10</span> <span class="mi">2</span><span class="p">)</span>
<span class="mi">5</span>
</pre></div>
</div>
<p>Scheme exclusively uses prefix notation. Operators are often symbols,
such as <code class="docutils literal notranslate"><span class="pre">+</span></code> and <code class="docutils literal notranslate"><span class="pre">*</span></code>. Compound expressions can be nested, and they
may span more than one line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="o">+</span> <span class="p">(</span><span class="o">*</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="o">-</span> <span class="mi">10</span> <span class="mi">6</span><span class="p">))</span>
<span class="mi">19</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="o">+</span> <span class="p">(</span><span class="o">*</span> <span class="mi">3</span>
        <span class="p">(</span><span class="o">+</span> <span class="p">(</span><span class="o">*</span> <span class="mi">2</span> <span class="mi">4</span><span class="p">)</span>
           <span class="p">(</span><span class="o">+</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span>
        <span class="p">)</span>
     <span class="p">)</span>
     <span class="p">(</span><span class="o">+</span> <span class="p">(</span><span class="o">-</span> <span class="mi">10</span> <span class="mi">7</span><span class="p">)</span>
        <span class="mi">6</span>
     <span class="p">)</span>
  <span class="p">)</span>
<span class="mi">57</span>
</pre></div>
</div>
<p>Evaluating a combination requires first examining the operator to see
if it represents a <em>special form</em> <a class="footnote-reference brackets" href="#id2" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>, which has its own evaluation
procedure. If the operator is not a special form, then the operator
and operand expressions are evaluated in some arbitrary order. The
function that is the value of the operator is then applied to the
arguments that are the values of the operands.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id2" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Scheme also allows the definition of <em>macros</em>, which perform
code transformations to a combination before evaluating it. We
will revisit <a class="reference internal" href="metaprogramming.html#scheme-macros"><span class="std std-ref">Scheme macros</span></a> later.</p>
</aside>
</aside>
<p>The <code class="docutils literal notranslate"><span class="pre">if</span></code> expression in Scheme is an example of a special form. While
it looks syntactically like a call expression, it has a different
evaluation procedure. The general form of an <code class="docutils literal notranslate"><span class="pre">if</span></code> expression is:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">&lt;predicate&gt;</span><span class="w"> </span><span class="nv">&lt;consequent&gt;</span><span class="w"> </span><span class="nv">&lt;alternative&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>To evaluate an <code class="docutils literal notranslate"><span class="pre">if</span></code> expression, the interpreter starts by evaluating
the <code class="docutils literal notranslate"><span class="pre">&lt;predicate&gt;</span></code> part of the expression. If the <code class="docutils literal notranslate"><span class="pre">&lt;predicate&gt;</span></code>
evaluates to a true value, the interpreter then evaluates the
<code class="docutils literal notranslate"><span class="pre">&lt;consequent&gt;</span></code> and returns its value. Otherwise it evaluates the
<code class="docutils literal notranslate"><span class="pre">&lt;alternative&gt;</span></code> and returns its value. The <code class="docutils literal notranslate"><span class="pre">&lt;alternative&gt;</span></code> may be
elided.</p>
<p>Numerical values can be compared using familiar comparison operators,
but prefix notation is used in this case as well:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&gt;=</span> <span class="mi">2</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">#t</span>
</pre></div>
</div>
<p>Truth values in Scheme, including the boolean values <code class="docutils literal notranslate"><span class="pre">#t</span></code> (for true)
and <code class="docutils literal notranslate"><span class="pre">#f</span></code> (for false), can be combined with boolean special forms,
which have evaluation procedures as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">(and</span> <span class="pre">&lt;e1&gt;</span> <span class="pre">...</span> <span class="pre">&lt;en&gt;)</span></code> The interpreter evaluates the expressions
<code class="docutils literal notranslate"><span class="pre">&lt;e&gt;</span></code> one at a time, in left-to-right order. If any <code class="docutils literal notranslate"><span class="pre">&lt;e&gt;</span></code>
evaluates to a false value, the value of the <code class="docutils literal notranslate"><span class="pre">and</span></code> expression is
that false value, and the rest of the <code class="docutils literal notranslate"><span class="pre">&lt;e&gt;</span></code>’s are not evaluated.
If all <code class="docutils literal notranslate"><span class="pre">&lt;e&gt;</span></code>’s evaluate to true values, the value of the <code class="docutils literal notranslate"><span class="pre">and</span></code>
expression is the value of the last one.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(or</span> <span class="pre">&lt;e1&gt;</span> <span class="pre">...</span> <span class="pre">&lt;en&gt;)</span></code> The interpreter evaluates the expressions
<code class="docutils literal notranslate"><span class="pre">&lt;e&gt;</span></code> one at a time, in left-to-right order. If any <code class="docutils literal notranslate"><span class="pre">&lt;e&gt;</span></code>
evaluates to a true value, that value is returned as the value of
the <code class="docutils literal notranslate"><span class="pre">or</span></code> expression, and the rest of the <code class="docutils literal notranslate"><span class="pre">&lt;e&gt;</span></code>’s are not
evaluated. If all <code class="docutils literal notranslate"><span class="pre">&lt;e&gt;</span></code>’s evaluate to false values, the value of
the <code class="docutils literal notranslate"><span class="pre">or</span></code> expression is the value of the last one.</p></li>
</ul>
<p>Truth values can also be manipulated with the <code class="docutils literal notranslate"><span class="pre">not</span></code> procedure:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">(not</span> <span class="pre">&lt;e&gt;)</span></code> The value of a not expression is <code class="docutils literal notranslate"><span class="pre">#t</span></code> when the
expression <code class="docutils literal notranslate"><span class="pre">&lt;e&gt;</span></code> evaluates to a false value, and <code class="docutils literal notranslate"><span class="pre">#f</span></code>
otherwise.</p></li>
</ul>
</section>
<section id="definitions">
<h2>Definitions<a class="headerlink" href="#definitions" title="Link to this heading"></a></h2>
<p>Values can be named using the <code class="docutils literal notranslate"><span class="pre">define</span></code> special form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="n">define</span> <span class="n">pi</span> <span class="mf">3.14</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="o">*</span> <span class="n">pi</span> <span class="mi">2</span><span class="p">)</span>
<span class="mf">6.28</span>
</pre></div>
</div>
<p>New functions (usually called <em>procedures</em> in Scheme) can be defined
using a second version of the <code class="docutils literal notranslate"><span class="pre">define</span></code> special form. For example, to
define squaring, we write:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">square</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">x</span><span class="p">))</span>
</pre></div>
</div>
<p>The general form of a procedure definition is:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">&lt;name&gt;</span><span class="w"> </span><span class="nv">&lt;formal</span><span class="w"> </span><span class="nv">parameters&gt;</span><span class="p">)</span><span class="w"> </span><span class="nv">&lt;body&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code> is a symbol to be associated with the procedure
definition in the environment. The <code class="docutils literal notranslate"><span class="pre">&lt;formal</span> <span class="pre">parameters&gt;</span></code> are the
names used within the body of the procedure to refer to the
corresponding arguments of the procedure. The <code class="docutils literal notranslate"><span class="pre">&lt;body&gt;</span></code> is an
expression that will yield the value of the procedure application when
the formal parameters are replaced by the actual arguments to which
the procedure is applied. The <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code> and the <code class="docutils literal notranslate"><span class="pre">&lt;formal</span>
<span class="pre">parameters&gt;</span></code> are grouped within parentheses, just as they would be in
an actual call to the procedure being defined.</p>
<p>Having defined square, we can now use it in call expressions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="n">square</span> <span class="mi">21</span><span class="p">)</span>
<span class="mi">441</span>

<span class="o">&gt;</span> <span class="p">(</span><span class="n">square</span> <span class="p">(</span><span class="o">+</span> <span class="mi">2</span> <span class="mi">5</span><span class="p">))</span>
<span class="mi">49</span>

<span class="o">&gt;</span> <span class="p">(</span><span class="n">square</span> <span class="p">(</span><span class="n">square</span> <span class="mi">3</span><span class="p">))</span>
<span class="mi">81</span>
</pre></div>
</div>
<p>User-defined functions can take multiple arguments and include special
forms in their bodies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="n">define</span> <span class="p">(</span><span class="n">average</span> <span class="n">x</span> <span class="n">y</span><span class="p">)</span>
    <span class="p">(</span><span class="o">/</span> <span class="p">(</span><span class="o">+</span> <span class="n">x</span> <span class="n">y</span><span class="p">)</span> <span class="mi">2</span><span class="p">))</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">average</span> <span class="mi">1</span> <span class="mi">3</span><span class="p">)</span>
<span class="mi">2</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">define</span> <span class="p">(</span><span class="nb">abs</span> <span class="n">x</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="o">&lt;</span> <span class="n">x</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">(</span><span class="o">-</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">x</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="nb">abs</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="mi">3</span>
</pre></div>
</div>
<p>Scheme supports local function definitions with static scope. We will
defer discussion of this until we cover <a class="reference internal" href="#higher-order-functions">higher-order functions</a>.</p>
<p>Anonymous functions, also called <em>lambda functions</em>, are created using
the <code class="docutils literal notranslate"><span class="pre">lambda</span></code> special form. A <code class="docutils literal notranslate"><span class="pre">lambda</span></code> is used to create a
procedure in the same way as <code class="docutils literal notranslate"><span class="pre">define</span></code>, except that no name is
specified for the procedure:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">&lt;formal-parameters&gt;</span><span class="p">)</span><span class="w"> </span><span class="nv">&lt;body&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting procedure is just as much a procedure as one that is
created using <code class="docutils literal notranslate"><span class="pre">define</span></code>. The only difference is that it has not been
associated with any name in the environment. In fact, the following
expressions are equivalent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="n">define</span> <span class="p">(</span><span class="n">plus4</span> <span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="o">+</span> <span class="n">x</span> <span class="mi">4</span><span class="p">))</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">define</span> <span class="n">plus4</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="o">+</span> <span class="n">x</span> <span class="mi">4</span><span class="p">)))</span>
</pre></div>
</div>
<p>Like any expression that has a procedure as its value, a lambda
expression can be used as the operator in a call expression:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="p">)</span> <span class="p">(</span><span class="o">+</span> <span class="n">x</span> <span class="n">y</span> <span class="p">(</span><span class="n">square</span> <span class="n">z</span><span class="p">)))</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
<span class="mi">12</span>
</pre></div>
</div>
<p>We will examine <a class="reference internal" href="#lambda-functions">lambda functions</a> in more detail later.</p>
</section>
<section id="compound-values">
<h2>Compound Values<a class="headerlink" href="#compound-values" title="Link to this heading"></a></h2>
<p>Pairs are built into the Scheme language. For historical reasons,
pairs are created with the <code class="docutils literal notranslate"><span class="pre">cons</span></code> built-in function (and thus, pairs
are also known as <em>cons cells</em>), and the elements of a pair are
accessed with <code class="docutils literal notranslate"><span class="pre">car</span></code> and <code class="docutils literal notranslate"><span class="pre">cdr</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="n">define</span> <span class="n">x</span> <span class="p">(</span><span class="n">cons</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
<span class="o">&gt;</span> <span class="n">x</span>
<span class="p">(</span><span class="mi">1</span> <span class="o">.</span> <span class="mi">2</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">car</span> <span class="n">x</span><span class="p">)</span>
<span class="mi">1</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">cdr</span> <span class="n">x</span><span class="p">)</span>
<span class="mi">2</span>
</pre></div>
</div>
<p><a class="reference internal" href="#figure-scheme-pair"><span class="std std-numref">Figure 18</span></a> illustrates the pair structure created by
<code class="docutils literal notranslate"><span class="pre">(cons</span> <span class="pre">1</span> <span class="pre">2)</span></code>.</p>
<figure class="align-center" id="id12">
<span id="figure-scheme-pair"></span><a class="reference internal image-reference" href="_images/scheme_pair.svg"><img alt="_images/scheme_pair.svg" src="_images/scheme_pair.svg" width="100" /></a>
<figcaption>
<p><span class="caption-number">Figure 18 </span><span class="caption-text">A pair consisting of the elements <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">2</span></code>.</span><a class="headerlink" href="#id12" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Recursive lists are also built into the language, using pairs. A
special value denoted <code class="docutils literal notranslate"><span class="pre">'()</span></code> represents the empty list. A
recursive list value is rendered by placing its elements within
parentheses, separated by spaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="n">cons</span> <span class="mi">1</span>
        <span class="p">(</span><span class="n">cons</span> <span class="mi">2</span>
              <span class="p">(</span><span class="n">cons</span> <span class="mi">3</span>
                    <span class="p">(</span><span class="n">cons</span> <span class="mi">4</span> <span class="s1">&#39;())</span>
              <span class="p">)</span>
         <span class="p">)</span>
  <span class="p">)</span>
<span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="nb">list</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">define</span> <span class="n">one</span><span class="o">-</span><span class="n">through</span><span class="o">-</span><span class="n">four</span> <span class="p">(</span><span class="nb">list</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">car</span> <span class="n">one</span><span class="o">-</span><span class="n">through</span><span class="o">-</span><span class="n">four</span><span class="p">)</span>
<span class="mi">1</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">cdr</span> <span class="n">one</span><span class="o">-</span><span class="n">through</span><span class="o">-</span><span class="n">four</span><span class="p">)</span>
<span class="p">(</span><span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">car</span> <span class="p">(</span><span class="n">cdr</span> <span class="n">one</span><span class="o">-</span><span class="n">through</span><span class="o">-</span><span class="n">four</span><span class="p">))</span>
<span class="mi">2</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">cons</span> <span class="mi">10</span> <span class="n">one</span><span class="o">-</span><span class="n">through</span><span class="o">-</span><span class="n">four</span><span class="p">)</span>
<span class="p">(</span><span class="mi">10</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">cons</span> <span class="mi">5</span> <span class="n">one</span><span class="o">-</span><span class="n">through</span><span class="o">-</span><span class="n">four</span><span class="p">)</span>
<span class="p">(</span><span class="mi">5</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#figure-scheme-list"><span class="std std-numref">Figure 19</span></a> demonstrates that the structure
corresponding to the list whose text representation is <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">2</span> <span class="pre">3</span> <span class="pre">4)</span></code>
consists of a sequence of pairs, terminated by the empty list
(represented in the diagram as a box containing the symbol
<span class="math notranslate nohighlight">\(\varnothing\)</span>).</p>
<figure class="align-center" id="id13">
<span id="figure-scheme-list"></span><a class="reference internal image-reference" href="_images/scheme_list.svg"><img alt="_images/scheme_list.svg" src="_images/scheme_list.svg" width="600" /></a>
<figcaption>
<p><span class="caption-number">Figure 19 </span><span class="caption-text">A list containing the elements <code class="docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">2</span></code>, <code class="docutils literal notranslate"><span class="pre">3</span></code>, and <code class="docutils literal notranslate"><span class="pre">4</span></code>.</span><a class="headerlink" href="#id13" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>A sequence of pairs that is terminated by something other than the
empty list is called an <em>improper list</em>. Such a list is rendered by
the interpreter with a dot preceding the last element; the result of
<code class="docutils literal notranslate"><span class="pre">(cons</span> <span class="pre">1</span> <span class="pre">2)</span></code> is an example, as shown above, consisting of just a
single pair in the sequence. The following demonstrates a more complex
sequence:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="n">cons</span> <span class="mi">1</span>
        <span class="p">(</span><span class="n">cons</span> <span class="mi">2</span>
              <span class="p">(</span><span class="n">cons</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
        <span class="p">)</span>
  <span class="p">)</span>
<span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="o">.</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#figure-scheme-improper-list"><span class="std std-numref">Figure 20</span></a> demonstrates the pair structure
corresponding to the improper list above.</p>
<figure class="align-center" id="id14">
<span id="figure-scheme-improper-list"></span><a class="reference internal image-reference" href="_images/scheme_improper_list.svg"><img alt="_images/scheme_improper_list.svg" src="_images/scheme_improper_list.svg" width="360" /></a>
<figcaption>
<p><span class="caption-number">Figure 20 </span><span class="caption-text">An improper list containing the elements <code class="docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">2</span></code>, and <code class="docutils literal notranslate"><span class="pre">3</span></code>,
and terminated by <code class="docutils literal notranslate"><span class="pre">4</span></code> rather than the empty list.</span><a class="headerlink" href="#id14" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The illustrations in <a class="reference internal" href="#figure-scheme-list"><span class="std std-numref">Figure 19</span></a> and
<a class="reference internal" href="#figure-scheme-improper-list"><span class="std std-numref">Figure 20</span></a> demonstrate that pairs and other
compound objects have <a class="reference internal" href="foundations.html#value-and-reference-semantics"><span class="std std-ref">reference semantics</span></a> – the <code class="docutils literal notranslate"><span class="pre">cdr</span></code> part of a pair stores a reference to the
next pair in the sequence. The following code further demonstrates
these reference semantics with variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt; (define x (cons 1 2))
&gt; (define y x)
&gt; (eqv? x y)
#t
&gt; (set-car! y 7)
&gt; x
(7 . 2)
</pre></div>
</div>
<p>Here, the definition <code class="docutils literal notranslate"><span class="pre">(define</span> <span class="pre">y</span> <span class="pre">x)</span></code> results in both <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>
referring to the same pair object. The <code class="docutils literal notranslate"><span class="pre">eqv?</span></code> procedure when applied
to pairs returns true only when the two arguments refer to the same
pair object (as opposed to <code class="docutils literal notranslate"><span class="pre">equal?</span></code>, which compares pairs
structurally). Furthermore, when we use the <code class="docutils literal notranslate"><span class="pre">set-car!</span></code> mutator to
modify the first item of the pair referenced by <code class="docutils literal notranslate"><span class="pre">y</span></code>, we can see that
<code class="docutils literal notranslate"><span class="pre">x</span></code> references the same pair since it too shows the modification.</p>
<p>Whether an object is the empty list can be determined using the
primitive <code class="docutils literal notranslate"><span class="pre">null?</span></code> predicate. Using it, we can define the standard
sequence operations for computing the length of a proper list and
selecting elements:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt; (define (list-length items)
    (if (null? items)
        0
        (+ 1 (list-length (cdr items)))
    )
  )
&gt; (define (getitem items n)
    (if (= n 0)
        (car items)
        (getitem (cdr items) (- n 1))
    )
  )
&gt; (define squares (list 1 4 9 16 25))
&gt; (length squares)
5
&gt; (getitem squares 3)
16
</pre></div>
</div>
<p>The built-in <code class="docutils literal notranslate"><span class="pre">length</span></code> and <code class="docutils literal notranslate"><span class="pre">list-ref</span></code> procedures provide the same
functionality as <code class="docutils literal notranslate"><span class="pre">list-length</span></code> and <code class="docutils literal notranslate"><span class="pre">getitem</span></code> here.</p>
</section>
<section id="symbolic-data">
<h2>Symbolic Data<a class="headerlink" href="#symbolic-data" title="Link to this heading"></a></h2>
<p>All the compound data objects we have used so far were constructed
ultimately from numbers. One of Scheme’s strengths is working with
arbitrary symbols as data.</p>
<p>In order to manipulate symbols we need a new element in our language:
the ability to <em>quote</em> a data object. Suppose we want to construct the
list <code class="docutils literal notranslate"><span class="pre">(a</span> <span class="pre">b)</span></code>. We can’t accomplish this with <code class="docutils literal notranslate"><span class="pre">(list</span> <span class="pre">a</span> <span class="pre">b)</span></code>, because
this expression constructs a list of the values of <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>
rather than the symbols themselves. In Scheme, we refer to the symbols
<code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> rather than their values by preceding them with a
single quotation mark:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="n">define</span> <span class="n">a</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">define</span> <span class="n">b</span> <span class="mi">2</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="nb">list</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span> <span class="mi">2</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="nb">list</span> <span class="s1">&#39;a &#39;</span><span class="n">b</span><span class="p">)</span>
<span class="p">(</span><span class="n">a</span> <span class="n">b</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="nb">list</span> <span class="s1">&#39;a b)</span>
<span class="p">(</span><span class="n">a</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>In Scheme, any expression that is not evaluated is said to be
<em>quoted</em>. This notion of quotation is derived from a classic
philosophical distinction between a thing, such as a dog, which runs
around and barks, and the word “dog” that is a linguistic construct
for designating such things. When we use “dog” in quotation marks, we
do not refer to some dog in particular but instead to a word. In
language, quotation allow us to talk about language itself, and so it
is in Scheme:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="nb">list</span> <span class="s1">&#39;define &#39;</span><span class="nb">list</span><span class="p">)</span>
<span class="p">(</span><span class="n">define</span> <span class="nb">list</span><span class="p">)</span>
</pre></div>
</div>
<p>Quotation also allows us to type in compound objects, using the
conventional printed representation for lists. We have already seen
that <code class="docutils literal notranslate"><span class="pre">'()</span></code> denotes an empty list. Here are other examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="n">car</span> <span class="s1">&#39;(a b c))</span>
<span class="n">a</span>

<span class="o">&gt;</span> <span class="p">(</span><span class="n">cdr</span> <span class="s1">&#39;(a b c))</span>
<span class="p">(</span><span class="n">b</span> <span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>Quotation in Scheme is distinct from strings: the latter represent
raw, unstructured data in character format, while the former
represents structured data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="s2">&quot;(- 3)&quot;</span>  <span class="p">;</span> <span class="n">a</span> <span class="n">string</span> <span class="n">containing</span> <span class="n">the</span> <span class="n">characters</span> <span class="c1">#\( #\- #\space #\3 #\)</span>
<span class="s2">&quot;(- 3)&quot;</span>
<span class="o">&gt;</span> <span class="s1">&#39;(- 3)   ; produces a list containing the symbol - and number 3</span>
<span class="p">(</span><span class="o">-</span> <span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">car</span> <span class="s1">&#39;(- 3))</span>
<span class="o">-</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">cdr</span> <span class="s1">&#39;(- 3))</span>
<span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="o">-</span> <span class="mi">3</span><span class="p">)</span>    <span class="p">;</span> <span class="n">calls</span> <span class="n">the</span> <span class="o">-</span> <span class="n">procedure</span> <span class="n">on</span> <span class="n">the</span> <span class="n">number</span> <span class="mi">3</span>
<span class="o">-</span><span class="mi">3</span>
</pre></div>
</div>
<p>In the examples above, the string literal <code class="docutils literal notranslate"><span class="pre">&quot;(-</span> <span class="pre">3)&quot;</span></code> evaluates to
itself. The quoted expression <code class="docutils literal notranslate"><span class="pre">'(-</span> <span class="pre">3)</span></code> evaluates to a list
containing the symbol <code class="docutils literal notranslate"><span class="pre">-</span></code> as its first element and the number 3 as
its second. The last example evaluates the symbol <code class="docutils literal notranslate"><span class="pre">-</span></code> to obtain the
corresponding procedure, evaluates the number 3 to itself, and then
calls the <code class="docutils literal notranslate"><span class="pre">-</span></code> procedure on the number 3, producing <code class="docutils literal notranslate"><span class="pre">-3</span></code>. Put
another way, data in a string literal remains as character data,
neither evaluated nor parsed. A quoted expression is parsed but not
evaluated, producing a structured representation of the data. An
unquoted expression is both parsed and evaluated by the interpreter.</p>
<p>The full Scheme language contains additional features, such as
mutation operations, vectors, and maps. However, the subset we have
introduced so far provides a rich functional programming language
capable of implementing many of the ideas we have discussed so far.</p>
</section>
</section>
<section id="functions">
<h1>Functions<a class="headerlink" href="#functions" title="Link to this heading"></a></h1>
<p>We first consider various schemes that are used for passing data to
functions in the form of parameters and arguments. We make a
distinction between the parameters that appear in a function
definition, which are also called <em>formal parameters</em>, and the actual
values that are passed to the function when it is called. The latter
are often called <em>actual parameters</em>, but we will use the term
<em>argument</em> to refer to these values and the shorthand <em>parameter</em> for
formal parameters.</p>
<section id="keyword-arguments">
<h2>Keyword Arguments<a class="headerlink" href="#keyword-arguments" title="Link to this heading"></a></h2>
<p>Some languages allow, or even require, parameter names to be provided
when calling a function. This strategy is called <em>named parameters</em> or
<em>keyword arguments</em>.</p>
<p>Keyword arguments generally allow arguments to be provided in a
different order than the parameter list of a function. In Python, for
example, a keyword argument can be used for any parameter. Consider
the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">foo()</span></code> without keyword arguments passes the first argument
as the first parameter, and the second argument as the second
parameter:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">1 2</span>
</pre></div>
</div>
<p>However, the arguments can be reordered using the parameter names:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">2 1</span>
</pre></div>
</div>
<p>Python also provides mechanisms for defining parameters to be
<a class="reference external" href="https://peps.python.org/pep-0570/">positional-only</a> or
<a class="reference external" href="https://peps.python.org/pep-3102/">keyword-only</a>, but we will not
discuss these mechanisms here.</p>
<p>A handful of languages require names to be provided for all or most
arguments by default, as well as requiring that they be given in the
same order as the parameters. The following is an example in Swift 3:</p>
<div class="highlight-swift notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nf">greet</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">withGreeting</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
  <span class="bp">print</span><span class="p">(</span><span class="n">withGreeting</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">greet</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&quot;world&quot;</span><span class="p">,</span> <span class="n">withGreeting</span><span class="p">:</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">greet()</span></code> with the arguments in reverse order is erroneous.</p>
<p>Swift is also rare in that it allows different argument and parameter
names to be specified for a parameter. This means that the name
provided for an argument when calling a function can differ from the
internal name of the parameter used in the body of the function.</p>
</section>
<section id="default-arguments">
<h2>Default Arguments<a class="headerlink" href="#default-arguments" title="Link to this heading"></a></h2>
<p>In some languages, a function declaration or definition may be
provided with a <em>default argument</em> value that allows the function to
be called without that argument. This can be an alternative to
overloading, where separate function definitions are written to handle
the cases where an argument is present or missing.</p>
<p>The following is an example in Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">power</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">exponent</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">base</span> <span class="o">**</span> <span class="n">exponent</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">power()</span></code> function can be called with a single argument, in
which case the default argument <code class="docutils literal notranslate"><span class="pre">2</span></code> is used to compute the square of
the number. It can also be called with two arguments to compute an
arbitrary power:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">power</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">power</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="go">81</span>
</pre></div>
</div>
<p>Parameters that have default arguments generally must appear at the
end of the parameter list. Languages differ on when and in which
environment they evaluate the default argument. The most common
strategy is to evaluate a default argument every time a function is
called, but to do so in the definition environment (static scope).
Python is rare in that it only evaluates default arguments once, when
the function definition statement is executed. This means that if the
value of the parameter is modified in the function, subsequent calls
to the same function could have different default values for the same
parameter. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">test</span><span class="p">()</span>
<span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p>This will print:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>C and C++ have numerous rules concerning default arguments,
necessitated by the fact that an entity can be declared multiple
times. Default arguments can be provided in both stand-alone
declarations as well as definitions. However, it is illegal for
multiple visible declarations of the same entity to provide a default
argument for the same parameter, even if the provided value is the
same. The set of default arguments is the union of all visible
declarations within the same scope, and a declaration may only
introduce a default argument for a parameter if all following
parameters have been supplied with default arguments by the previous
and current declarations. Names used in a default argument are
resolved at the point of declaration, but the argument expressions are
evaluated when the function is called.</p>
<p>The following is a legal example of multiple declarations in C++:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>C++ allows default arguments for template parameters in addition to
function parameters, with similar validity rules.</p>
</section>
<section id="variadic-functions">
<h2>Variadic Functions<a class="headerlink" href="#variadic-functions" title="Link to this heading"></a></h2>
<p>A language may provide a mechanism for a function to be called with a
variable number of arguments. This feature is often referred to as
<em>varargs</em>, and functions that make use of it are <em>variadic</em>. The
mechanism may provide type safety, or it may permit unsafe uses that
result in erroneous or undefined behavior. A variadic parameter
generally must appear at the end of a parameter list, and it matches
arguments that remain once the non-variadic parameters are matched.
Usually, only a single variadic parameter is allowed.</p>
<p>In languages that provide safe variadic functions, a common mechanism
for doing so is to automatically package variable arguments into a
container, such as an array or tuple. For example, the following
Python function computes the product of its arguments:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">product</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">*=</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">*</span></code> in front of a parameter name indicates a variadic parameter,
and the variable arguments are passed as a tuple bound to that name.
The function above iterates over the elements of the tuple, updating
the total product. In order to call <code class="docutils literal notranslate"><span class="pre">product()</span></code>, 0 or more arguments
must be provided:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">product</span><span class="p">()</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">product</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">6</span>
</pre></div>
</div>
<p>Python also provides variadic keyword arguments, which are packaged
into a dictionary. Placing <code class="docutils literal notranslate"><span class="pre">**</span></code> in front of a parameter specifies
that it is a variadic keyword parameter, and such a parameter must be
the last one. As an example, the following function has both a
non-keyword variadic parameter and a variadic keyword parameter,
printing out the tuple corresponding to the former and the dictionary
for the latter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">print_args</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
<span class="go">(3, 4)</span>
<span class="go">{&#39;x&#39;: 5, &#39;y&#39;: 6}</span>
</pre></div>
</div>
<p>Finally, Python allows a sequence or dictionary to be “unpacked” using
the <code class="docutils literal notranslate"><span class="pre">*</span></code> or <code class="docutils literal notranslate"><span class="pre">**</span></code> operator, allowing the unpacked values to be used
where a list of values is required. For example, the following unpacks
a list to make a call to <code class="docutils literal notranslate"><span class="pre">product()</span></code>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="go">6</span>
</pre></div>
</div>
<p>Scheme also supports variadic arguments. A procedure can be defined to
take variadic arguments by using an improper list as the parameter
list, terminated by a symbol rather than an empty list. The variadic
parameter binds to any number of arguments, packaged into a (proper)
list:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="n">define</span> <span class="p">(</span><span class="n">func</span> <span class="o">.</span> <span class="n">args</span><span class="p">)</span>
    <span class="n">args</span>
  <span class="p">)</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="p">()</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">func</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>The procedure <code class="docutils literal notranslate"><span class="pre">func</span></code> takes in any number of arguments and returns
the list containing those arguments. It thus behaves as the built-in
<code class="docutils literal notranslate"><span class="pre">list</span></code> procedure. We can also define a procedure that takes in both
required and variadic arguments, as in the following definition of
<code class="docutils literal notranslate"><span class="pre">average</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="n">define</span> <span class="p">(</span><span class="n">average</span> <span class="n">x</span> <span class="o">.</span> <span class="n">nums</span><span class="p">)</span>
    <span class="p">(</span><span class="o">/</span> <span class="p">(</span><span class="n">apply</span> <span class="o">+</span> <span class="n">x</span> <span class="n">nums</span><span class="p">)</span>
       <span class="p">(</span><span class="o">+</span> <span class="mi">1</span> <span class="p">(</span><span class="n">length</span> <span class="n">nums</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">average</span> <span class="mi">1</span><span class="p">)</span>
<span class="mi">1</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">average</span> <span class="mi">1</span> <span class="mi">3</span><span class="p">)</span>
<span class="mi">2</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">average</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span><span class="p">)</span>
<span class="mi">4</span>
</pre></div>
</div>
<p>The procedure takes in one or more arguments, with the first bound to
the parameter <code class="docutils literal notranslate"><span class="pre">x</span></code> and the rest encapsulated in a list bound to the
variadic <code class="docutils literal notranslate"><span class="pre">nums</span></code> parameter. We can forward variadic arguments using
<code class="docutils literal notranslate"><span class="pre">apply</span></code>, which takes a procedure, any number of regular arguments,
and lastly, a list containing the remaining arguments. For example,
<code class="docutils literal notranslate"><span class="pre">(apply</span> <span class="pre">+</span> <span class="pre">1</span> <span class="pre">2</span> <span class="pre">'(3</span> <span class="pre">4))</span></code> is equivalent to the call <code class="docutils literal notranslate"><span class="pre">(+</span> <span class="pre">1</span> <span class="pre">2</span> <span class="pre">3</span> <span class="pre">4)</span></code>. In
the first example using <code class="docutils literal notranslate"><span class="pre">average</span></code> above, <code class="docutils literal notranslate"><span class="pre">nums</span></code> is bound to an
empty list in the call <code class="docutils literal notranslate"><span class="pre">(average</span> <span class="pre">1)</span></code>, and <code class="docutils literal notranslate"><span class="pre">(apply</span> <span class="pre">+</span> <span class="pre">x</span> <span class="pre">nums)</span></code> is
equivalent to <code class="docutils literal notranslate"><span class="pre">(apply</span> <span class="pre">+</span> <span class="pre">1</span> <span class="pre">'())</span></code>, which itself is equivalent to <code class="docutils literal notranslate"><span class="pre">(+</span>
<span class="pre">1)</span></code>. In the third example, <code class="docutils literal notranslate"><span class="pre">nums</span></code> is bound to a list <code class="docutils literal notranslate"><span class="pre">(3</span> <span class="pre">5</span> <span class="pre">7)</span></code>,
so <code class="docutils literal notranslate"><span class="pre">(apply</span> <span class="pre">+</span> <span class="pre">x</span> <span class="pre">nums)</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">(apply</span> <span class="pre">+</span> <span class="pre">1</span> <span class="pre">'(3</span> <span class="pre">5</span> <span class="pre">7))</span></code>,
which is in turn equivalent to <code class="docutils literal notranslate"><span class="pre">(+</span> <span class="pre">1</span> <span class="pre">3</span> <span class="pre">5</span> <span class="pre">7)</span></code>.</p>
<p>In both Python and Scheme, a variadic parameter can match arguments
with any type because the two languages are dynamically typed. In
statically typed languages, however, variadic parameters are usually
restricted to a single type, though that type may be polymorphic. For
example, the following is a variadic method in Java:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">print_all</span><span class="p">(</span><span class="n">String</span><span class="p">...</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The arguments to <code class="docutils literal notranslate"><span class="pre">print_all()</span></code> must be <code class="docutils literal notranslate"><span class="pre">String</span></code>s, and they are
packaged into a <code class="docutils literal notranslate"><span class="pre">String</span></code> array. Java also allows a single <code class="docutils literal notranslate"><span class="pre">String</span></code>
array to be passed in as an argument:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">print_all</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;world&quot;</span><span class="p">);</span>
<span class="n">print_all</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;good&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bye&quot;</span><span class="w"> </span><span class="p">});</span>
</pre></div>
</div>
<p>C and C++ also have a mechanism for variadic arguments, but it poses
significant safety issues. In particular, it provides no information
about the number of arguments and their types to the function being
called. The following is an example of a function that returns the
sum of its arguments:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdarg.h&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">va_list</span><span class="w"> </span><span class="n">args</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">  </span><span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">va_arg</span><span class="p">(</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">total</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this function, the first argument is assumed to be the number of
remaining arguments, and the latter are assumed to have type <code class="docutils literal notranslate"><span class="pre">int</span></code>.
Undefined behavior results if either of these conditions is violated.
Another strategy is to use a format string to determine the number and
types of arguments, as used in <code class="docutils literal notranslate"><span class="pre">printf()</span></code> and similar functions. The
lack of safety of variadic arguments enables vulnerabilities such as
<a class="reference external" href="https://en.wikipedia.org/wiki/Uncontrolled_format_string">format string attacks</a>.</p>
<p>C++11 provides <a class="reference internal" href="metaprogramming.html#variadic-templates"><span class="std std-ref">variadic templates</span></a> that
are type safe. We will discuss them later in the text.</p>
</section>
<section id="parameter-passing">
<span id="id3"></span><h2>Parameter Passing<a class="headerlink" href="#parameter-passing" title="Link to this heading"></a></h2>
<p>Another area in which languages differ is in the semantics and
mechanism used in order to communicate arguments between a function
and its caller. A function parameter may be unidirectional (used for
only passing input to a function or only passing output from a
function to its caller), or it may be bidirectional. These cases are
referred to as <em>input</em>, <em>output</em>, and <em>input/output</em> parameters. A
language need not support all three parameter categories.</p>
<p>Different parameter passing techniques, or <em>call modes</em>, are used by
languages. These affect the semantics of arguments and parameters as
well as what parameter categories are supported. The following are
specific call modes used by different languages:</p>
<ul>
<li><p><em>Call by value</em>. A parameter represents a new variable in the frame
of a function invocation. The argument value is copied into the
storage associated with the new variable. Call-by-value parameters
only provide input to a function, as in the following example in
C++:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">x</span><span class="o">++</span><span class="p">;</span>
<span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="n">foo</span><span class="p">(</span><span class="n">y</span><span class="p">);</span><span class="w">              </span><span class="c1">// prints 4</span>
<span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">   </span><span class="c1">// prints 3</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Even though <code class="docutils literal notranslate"><span class="pre">foo()</span></code> modifies the input value, the modified value
is not propagated back to the caller.</p>
</li>
<li><p><em>Call by reference</em>. An l-value must be passed as the argument, as
the parameter aliases the object that is passed in. Any
modifications to the parameter are reflected in the argument object.
Thus, call by reference parameters provide both input and output. In
C++, reference parameters provide call by reference, and they may be
restricted to just input by declaring them <code class="docutils literal notranslate"><span class="pre">const</span></code> <a class="footnote-reference brackets" href="#id5" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>. The
following C++ example uses call by reference to swap the values of
two objects:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">swap</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">  </span><span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">   </span><span class="c1">// prints 4 3</span>
<span class="p">}</span>
</pre></div>
</div>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id5" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">2</a><span class="fn-bracket">]</span></span>
<p>The <code class="docutils literal notranslate"><span class="pre">const</span></code> qualification further allows r-values to be
passed as an argument, since C++ allows <code class="docutils literal notranslate"><span class="pre">const</span></code> l-value
references to bind to r-values.</p>
</aside>
</aside>
<p>Call by reference is sometimes used to refer to passing objects
indirectly using pointers. The following C/C++ function swaps object
values using pointers:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">swap</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
<span class="w">  </span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">;</span>
<span class="w">  </span><span class="o">*</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">  </span><span class="n">swap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y</span><span class="p">);</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w">   </span><span class="c1">// prints 4 3</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Technically speaking, however, the arguments and parameters are
separate pointer objects that are passed by value. That being said,
the effect emulates call by reference, enabling both input and
output to be achieved through a parameter.</p>
</li>
<li><p><em>Call by result</em>. In this mode, a parameter represents a new
variable that is not initialized with a value from the caller.
Instead, the caller specifies an l-value for the argument, and when
the function call terminates, the final value of the parameter is
copied to the l-value. Thus, call by result only provides output
parameters. The following is an example, using C-like syntax with
call by result:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="n">x</span><span class="o">++</span><span class="p">;</span><span class="w">      </span><span class="c1">// x is now 4</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="n">foo</span><span class="p">(</span><span class="n">y</span><span class="p">);</span><span class="w">     </span><span class="c1">// y is now 4</span>
<span class="n">print</span><span class="p">(</span><span class="n">y</span><span class="p">);</span><span class="w">   </span><span class="c1">// prints 4</span>
</pre></div>
</div>
</li>
<li><p><em>Call by value-result</em>. This is the combination of call by value and
call by result. The argument value is copied into a new variable
corresponding to the parameter, and then upon return from the
function, the value of the parameter is copied back to the l-value
provided by the caller. This differs from call by reference in that
copies are made upon entry and exit to the function. This can be
illustrated by passing the same l-value to multiple parameters, as
in the following example using C-like syntax with call by
value-result:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">value</span><span class="o">-</span><span class="n">result</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">-</span><span class="n">result</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">x</span><span class="o">++</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="n">print</span><span class="p">(</span><span class="n">foo</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">));</span><span class="w">   </span><span class="c1">// prints 1</span>
<span class="n">print</span><span class="p">(</span><span class="n">z</span><span class="p">);</span><span class="w">           </span><span class="c1">// prints 3 or 4, depending on the semantics</span>
</pre></div>
</div>
<p>In this code, <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are new variables that are initialized
to the value of <code class="docutils literal notranslate"><span class="pre">z</span></code>, i.e. 3. The increment of <code class="docutils literal notranslate"><span class="pre">x</span></code> does not
affect <code class="docutils literal notranslate"><span class="pre">y</span></code>, since they are separate variables, so the call to
<code class="docutils literal notranslate"><span class="pre">foo()</span></code> returns 1. Thus, 1 is printed. (The final value of <code class="docutils literal notranslate"><span class="pre">z</span></code>
depends on the semantics of the language as to whether it is copied
from <code class="docutils literal notranslate"><span class="pre">x</span></code> or <code class="docutils literal notranslate"><span class="pre">y</span></code>.) If call by reference were used instead, then
<code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> would alias the same object, and the call to
<code class="docutils literal notranslate"><span class="pre">foo()</span></code> would return 0.</p>
</li>
<li><p><em>Call by name</em>. In this mode, a full expression can be provided as
an argument, but it is not evaluated at the time a function is
called. Instead, the parameter name is replaced by the expression
where the name occurs in the function, and the expression is
evaluated at the time that it is encountered in the body. This is a
form of <em>lazy evaluation</em>, where a value is not computed until it is
needed. The following is an example using C-like syntax with call by
name:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">print</span><span class="p">(</span><span class="n">b</span><span class="p">);</span><span class="w">   </span><span class="c1">// becomes print(++y)</span>
<span class="w">  </span><span class="n">print</span><span class="p">(</span><span class="n">b</span><span class="p">);</span><span class="w">   </span><span class="c1">// becomes print(++y)</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="n">foo</span><span class="p">(</span><span class="o">++</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">++</span><span class="n">y</span><span class="p">);</span><span class="w">   </span><span class="c1">// prints 4, then 4 or 5 depending on the exact</span>
<span class="w">                 </span><span class="c1">// language semantics; y is now 4 or 5</span>
<span class="n">print</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w">        </span><span class="c1">// prints -1 -- x is unchanged</span>
</pre></div>
</div>
<p>In this example, the argument expression <code class="docutils literal notranslate"><span class="pre">++x</span></code> is never evaluated
since the corresponding call-by-name parameter <code class="docutils literal notranslate"><span class="pre">a</span></code> is never used.
On the other hand, the expression <code class="docutils literal notranslate"><span class="pre">++y</span></code> is computed since the
corresponding parameter <code class="docutils literal notranslate"><span class="pre">b</span></code> does get used. Depending on the
language semantics, the expression may only be evaluated once and
the value cached for subsequent use, or it may be evaluated each
time the parameter is used.</p>
<p>There is a subtle issue that arises in call by name. Consider the
following code that uses C-like syntax with call by name:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">bar</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="n">print</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">bar</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>If we replace the occurrence of the parameter <code class="docutils literal notranslate"><span class="pre">x</span></code> in <code class="docutils literal notranslate"><span class="pre">bar()</span></code>
with the argument expression, we get <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">+</span> <span class="pre">1</span> <span class="pre">+</span> <span class="pre">y</span></code> as the argument
to <code class="docutils literal notranslate"><span class="pre">print()</span></code>. If this is evaluated in the environment of
<code class="docutils literal notranslate"><span class="pre">bar()</span></code>, the result is 7. This is undesirable, since it means that
the implementation detail of a local declaration of <code class="docutils literal notranslate"><span class="pre">y</span></code> changes
the behavior of the function.</p>
<p>Instead, the argument expression should be evaluated in the
environment of caller. This requires passing both the argument and
its environment to the function invocation. Languages that use call
by name often use a compiler-generated local function, called a
<em>thunk</em>, to encapsulate the argument expression and its environment.
This thunk is then passed to the invoked function, and it is the
thunk that is called when the parameter is encountered.</p>
<p>In some languages, the expression corresponding to a call-by-name
parameter is only evaluated the first time the parameter is
referenced, caching the result. The cached result is then used in
each subsequent occurrence of the parameter.</p>
</li>
</ul>
<p>Call by value is the call mode used by most modern languages,
including C, C++ (for non-reference parameters), Java, Scheme, and
Python. Programmers often mistakenly believe the latter three
languages use call by reference, but in reality, they combine call by
value with reference semantics. This combination is sometimes called
<em>call by object reference</em>. The following example illustrates that
Python is call by value:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">y</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">tmp</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<span class="go">(1, 2)</span>
</pre></div>
</div>
<p>The erroneous <code class="docutils literal notranslate"><span class="pre">swap()</span></code> function merely changes the values of the
local variables, which changes the objects they refer to, without
affecting the variables used as arguments. This demonstrates that the
storage for the global <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> is distinct from that of the
parameters, so Python does not use call by reference. In fact, Python
cannot even emulate call by reference in the manner that C and C++
pointers do.</p>
</section>
<section id="evaluation-of-function-calls">
<h2>Evaluation of Function Calls<a class="headerlink" href="#evaluation-of-function-calls" title="Link to this heading"></a></h2>
<p>We proceed to summarize to evaluation process of a function call.</p>
<p>The first step is to determine the non-local environment of a call to
a nested function. In languages with nested functions and static
scope, a reference to the non-local environment is stored in the
associated function object when the nested-function definition itself
is executed. Under dynamic scope with deep binding, the non-local
environment is determined when the function is referenced by name.
Finally, in dynamic scope with shallow binding, the non-local
environment is the environment that is active when the function is
called.</p>
<p>The next step is to pass the arguments to the function, using a newly
created activation record for the function call. The arguments are
evaluated in the existing environment and passed to the callee as
follows:</p>
<ol class="arabic simple">
<li><p><strong>Call by value and call by value-result</strong>: the argument is
evaluated to obtain its r-value. The r-value is copied into the
storage for the corresponding parameter in the new activation
record.</p></li>
<li><p><strong>Call by reference</strong>: the argument is evaluated to obtain its
l-value. The corresponding parameter is bound to the object
associated with the l-value.</p></li>
<li><p><strong>Call by result</strong>: the argument is evaluated to obtain its
l-value. Storage is allocated but not initialized within the new
activation record.</p></li>
<li><p><strong>Call by name</strong>: the argument expression is packaged into a thunk
with the current environment. The parameter is bound to a reference
to the thunk.</p></li>
</ol>
<p>Once the parameters have been passed, execution of the caller pauses,
and the body of the callee is executed in an environment consisting of
the newly created activation record along with the callee’s non-local
environment. For call by name, an occurrence of a call-by-name
parameter invokes the corresponding thunk either the first time the
parameter is named or every time, according to the semantics of the
language.</p>
<p>When the called function returns, its return value, if there is one,
is placed in a designated storage location, generally in the
activation record of the caller. For a call-by-result or
call-by-value-result parameter, the current r-value of the parameter
is copied into the object associated with the l-value of the
corresponding function-call argument. The activation record for the
callee is then destroyed, and execution resumes in the caller at the
point following the function call. The evaluation result of the
function call itself is the return value of the function.</p>
</section>
</section>
<section id="recursion">
<h1>Recursion<a class="headerlink" href="#recursion" title="Link to this heading"></a></h1>
<p>Recursion is a mechanism for repetition that makes use of functions
and function application. It involves a function calling itself
directly or indirectly, usually with arguments that are in some sense
“smaller” than the previous arguments. A recursive computation
terminates when it reaches a <em>base case</em>, an input where the result
can be computed directly without making any recursive calls.</p>
<p>It is sufficient for a language to provide recursion and conditionals
in order for it to be Turing complete.</p>
<section id="activation-records">
<h2>Activation Records<a class="headerlink" href="#activation-records" title="Link to this heading"></a></h2>
<p>On a machine, recursion works due to the fact that each invocation of
a function has its own activation record that maps its local variables
to values. Consider the following recursive definition of factorial:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">factorial(4)</span></code> results in five invocations of
<code class="docutils literal notranslate"><span class="pre">factorial()</span></code>, with arguments from 4 down to 0. Each has its own
activation record with its own binding for the parameter <code class="docutils literal notranslate"><span class="pre">n</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">factorial</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>   <span class="n">n</span> <span class="o">--&gt;</span> <span class="mi">4</span>
<span class="n">factorial</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>   <span class="n">n</span> <span class="o">--&gt;</span> <span class="mi">3</span>
<span class="n">factorial</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>   <span class="n">n</span> <span class="o">--&gt;</span> <span class="mi">2</span>
<span class="n">factorial</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>   <span class="n">n</span> <span class="o">--&gt;</span> <span class="mi">1</span>
<span class="n">factorial</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>   <span class="n">n</span> <span class="o">--&gt;</span> <span class="mi">0</span>
</pre></div>
</div>
<p><a class="reference internal" href="#figure-factorial"><span class="std std-numref">Figure 21</span></a> is an illustration of the set of activation
records as produced by <a class="reference external" href="http://www.pythontutor.com/">Python Tutor</a>.</p>
<figure class="align-center" id="id15">
<span id="figure-factorial"></span><a class="reference internal image-reference" href="_images/factorial.svg"><img alt="_images/factorial.svg" src="_images/factorial.svg" width="400" /></a>
<figcaption>
<p><span class="caption-number">Figure 21 </span><span class="caption-text">Activation records used to compute <code class="docutils literal notranslate"><span class="pre">factorial(4)</span></code>.</span><a class="headerlink" href="#id15" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>When <code class="docutils literal notranslate"><span class="pre">n</span></code> is looked up while executing the body of <code class="docutils literal notranslate"><span class="pre">factorial()</span></code>,
each invocation obtains its own value of <code class="docutils literal notranslate"><span class="pre">n</span></code> without being affected
by the other activation records.</p>
<p>An activation record requires more than just storage for parameters
and local variables in order for function invocation to work.
Temporary values also need to be stored somewhere, and since each
invocation needs its own storage for temporaries, they are generally
also placed in the activation record. An invocation also needs to know
where to store its return value, usually in temporary storage in the
frame of the caller. Finally, a function needs to know how to return
execution to its caller. Details are beyond the scope of this text,
but included in this information is the instruction address that
follows the function call in the caller and the address of the
caller’s activation record.</p>
<p>The set of temporary objects can be conservatively determined
statically, so the size of an activation record, as well as the
placement of objects within it, can be determined at compile time. For
<code class="docutils literal notranslate"><span class="pre">factorial()</span></code> above, temporary storage is required for <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">-</span> <span class="pre">1</span></code> as
well as the result of the recursive call to <code class="docutils literal notranslate"><span class="pre">factorial()</span></code>. The
location of the latter in the caller is used by a recursive call to
store its return value. Depending on the implementation, the
invocation of <code class="docutils literal notranslate"><span class="pre">factorial(0)</span></code> may still have space for these
temporary objects in its activation record even though they will not
be used.</p>
</section>
<section id="tail-recursion">
<h2>Tail Recursion<a class="headerlink" href="#tail-recursion" title="Link to this heading"></a></h2>
<p>A recursive computation uses a separate activation record for each
call to a function. The amount of space required to store these
records is proportional to the number of active function calls. In
<code class="docutils literal notranslate"><span class="pre">factorial(n)</span></code> above, when the computation reaches <code class="docutils literal notranslate"><span class="pre">factorial(0)</span></code>,
all <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">+</span> <span class="pre">1</span></code> invocations are active at the same time, requiring space
in <code class="docutils literal notranslate"><span class="pre">O(n)</span></code>. Contrast this with the following iterative implementation
that uses constant space:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">factorial_iter</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">*=</span> <span class="n">n</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>The space requirements of the recursive version of <code class="docutils literal notranslate"><span class="pre">factorial()</span></code>,
however, is not intrinsic to the use of recursion but is a result of
how the function is written. An invocation of <code class="docutils literal notranslate"><span class="pre">factorial(k)</span></code> cannot
complete until the recursive call to <code class="docutils literal notranslate"><span class="pre">factorial(k</span> <span class="pre">-</span> <span class="pre">1)</span></code> does, since
it has to multiply the result by <code class="docutils literal notranslate"><span class="pre">k</span></code>. The fact that the invocation
has work that needs to be done after the recursive call requires its
activation record to be retained during the recursive call, leading to
the linear space requirement.</p>
<p>Consider an alternative recursive computation of factorial:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">factorial_tail</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">partial_result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">partial_result</span>
    <span class="k">return</span> <span class="n">factorial_tail</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">*</span> <span class="n">partial_result</span><span class="p">)</span>
</pre></div>
</div>
<p>Observe that the <code class="docutils literal notranslate"><span class="pre">factorial_tail()</span></code> function does not do any work
after the completion of its recursive call. This means that it no
longer needs the storage for parameters, local variables, or temporary
objects when the recursive call is made. Furthermore, since
<code class="docutils literal notranslate"><span class="pre">factorial(n,</span> <span class="pre">k)</span></code> directly returns the result of the recursive call
<code class="docutils literal notranslate"><span class="pre">factorial(n</span> <span class="pre">-</span> <span class="pre">1,</span> <span class="pre">n</span> <span class="pre">*</span> <span class="pre">k)</span></code>, the latter can store its return value in
the location meant for the return value of <code class="docutils literal notranslate"><span class="pre">factorial(n,</span> <span class="pre">k)</span></code> in the
caller of <code class="docutils literal notranslate"><span class="pre">factorial(n,</span> <span class="pre">k)</span></code>, and it can return execution directly to
that caller. Thus, an optimizing implementation can reuse the space
for the activation record of <code class="docutils literal notranslate"><span class="pre">factorial_tail(n,</span> <span class="pre">k)</span></code> for
<code class="docutils literal notranslate"><span class="pre">factorial_tail(n</span> <span class="pre">-</span> <span class="pre">1,</span> <span class="pre">n</span> <span class="pre">*</span> <span class="pre">k)</span></code> since the activation record of the
former is no longer required.</p>
<p>This process can be generalized to any function call, not just
recursive calls. A function call is a <em>tail call</em> if its caller
directly returns the value of the call without performing any
additional computation. A function is <em>tail recursive</em> if all of its
recursive calls are tail calls. Thus, <code class="docutils literal notranslate"><span class="pre">factorial_tail()</span></code> is tail
recursive.</p>
<p>A tail-recursive computation uses only a constant number of activation
records, so its space usage matches that of an equivalent iterative
computation. In fact, many functional languages do not provide
constructs for iteration, since they can be expressed equivalently
using tail recursion. These languages often require that
implementations perform <em>tail-call optimization</em>, reusing the space
for activation records where possible.</p>
<p>Since a tail call requires that no computation be performed after it
returns, calls that syntactically appear to be tail calls may not be
when implicit computation may occur at the end of a function. A
specific example of this is scope-based resource management, as in the
example below:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">partial_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">partial_result</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
<span class="p">}</span>
</pre></div>
</div>
<p>While it appears that this code does not do computation after the
recursive call, the local <code class="docutils literal notranslate"><span class="pre">vector&lt;int&gt;</span></code> object has a destructor that
must run after the recursive call completes. Thus, the recursive call
to <code class="docutils literal notranslate"><span class="pre">sum()</span></code> is not a tail call, and this computation is not tail
recursive.</p>
<p>Another situation that prevents tail-call optimization is when a
function contains a function definition within it, in languages that
use static scope and support the full power of higher-order functions.
The nested function requires access to its definition environment, so
that environment must be retained if the nested function can be used
after the invocation of its enclosing function completes or within a
tail call.</p>
</section>
</section>
<section id="higher-order-functions">
<span id="id6"></span><h1>Higher-Order Functions<a class="headerlink" href="#higher-order-functions" title="Link to this heading"></a></h1>
<p>Recall that a first-class entity is one that supports the operations
that can be done on other entities in a language, including being
passed as a parameter, returned from a function, and created
dynamically. In a language in which functions are first class, it is
possible to write <em>higher-order functions</em> that take in another
function as a parameter or return a function. Other languages may also
support higher-order functions, even if functions are not first-class
entities that can be created at runtime.</p>
<section id="function-objects">
<h2>Function Objects<a class="headerlink" href="#function-objects" title="Link to this heading"></a></h2>
<p>In some languages, it is possible to define objects that aren’t
functions themselves but provide the same interface as a function.
These are known as <em>function objects</em> or <em>functors</em>. In general,
languages enable functors to be written by allowing the function-call
operator to be overloaded. Consider the following example in C++:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Counter</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="nl">Counter</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="k">operator</span><span class="p">()()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Counter</span></code> class implements a functor that returns how many times
it has been called. Multiple <code class="docutils literal notranslate"><span class="pre">Counter</span></code> objects can exist
simultaneously, each with their own count:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Counter</span><span class="w"> </span><span class="n">counter1</span><span class="p">,</span><span class="w"> </span><span class="n">counter2</span><span class="p">;</span>
<span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">counter1</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">  </span><span class="c1">// prints 0</span>
<span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">counter1</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">  </span><span class="c1">// prints 1</span>
<span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">counter1</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">  </span><span class="c1">// prints 2</span>
<span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">counter2</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">  </span><span class="c1">// prints 0</span>
<span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">counter2</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">  </span><span class="c1">// prints 1</span>
<span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">counter1</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">  </span><span class="c1">// prints 3</span>
</pre></div>
</div>
<p>Functors allow multiple instances of a function-like object to exist,
each with their own state that persists over the lifetime of the
functor. This is in contrast to functions, where automatic objects do
not persist past a single invocation, and static objects persist over
the entire program execution.</p>
<p>Python also allows functors to be written by defining the special
<code class="docutils literal notranslate"><span class="pre">__call__</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Counter</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span>
</pre></div>
</div>
<p>In general, additional parameters can be specified when overloading
the function-call operator, emulating functions that can take in those
arguments.</p>
<p>Some languages do not allow the function-call operator itself to be
overloaded but specify conventions that allow functor-like objects to
be defined and used. For example, the following is an implementation
of <code class="docutils literal notranslate"><span class="pre">Counter</span></code> in Java using the <code class="docutils literal notranslate"><span class="pre">Supplier&lt;T&gt;</span></code> interface, which
specifies a zero-argument method that produces a <code class="docutils literal notranslate"><span class="pre">T</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">Counter</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="nf">get</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This functor-like object is then invoked by explicitly calling the
<code class="docutils literal notranslate"><span class="pre">get()</span></code> method:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">counter1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Counter</span><span class="p">();</span>
<span class="n">Supplier</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">counter2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Counter</span><span class="p">();</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">counter1</span><span class="p">.</span><span class="na">get</span><span class="p">());</span><span class="w"> </span><span class="c1">// prints 0</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">counter1</span><span class="p">.</span><span class="na">get</span><span class="p">());</span><span class="w"> </span><span class="c1">// prints 1</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">counter1</span><span class="p">.</span><span class="na">get</span><span class="p">());</span><span class="w"> </span><span class="c1">// prints 2</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">counter2</span><span class="p">.</span><span class="na">get</span><span class="p">());</span><span class="w"> </span><span class="c1">// prints 0</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">counter2</span><span class="p">.</span><span class="na">get</span><span class="p">());</span><span class="w"> </span><span class="c1">// prints 1</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">counter1</span><span class="p">.</span><span class="na">get</span><span class="p">());</span><span class="w"> </span><span class="c1">// prints 3</span>
</pre></div>
</div>
<p>As another example, the <code class="docutils literal notranslate"><span class="pre">Predicate</span></code> interface in Java is implemented
by functor-like objects that take in an argument and return a boolean
value:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">interface</span> <span class="nc">Predicate</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">GreaterThan</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="nf">GreaterThan</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">threshold</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">threshold</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">threshold</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">threshold</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Code that uses these functor-like objects calls the <code class="docutils literal notranslate"><span class="pre">test()</span></code> method
rather than calling the object directly:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">GreaterThan</span><span class="w"> </span><span class="n">gt3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GreaterThan</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">gt3</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span><span class="w">    </span><span class="c1">// prints out false</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">gt3</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span><span class="w">   </span><span class="c1">// prints out true</span>
</pre></div>
</div>
<p>Separate interfaces are provided for common patterns in the
<code class="docutils literal notranslate"><span class="pre">java.util.function</span></code> library package.</p>
</section>
<section id="functions-as-parameters">
<h2>Functions as Parameters<a class="headerlink" href="#functions-as-parameters" title="Link to this heading"></a></h2>
<p>A higher-order function may take another function as a parameter. We
first examine languages that only have top-level functions and allow a
pointer or reference to a function to be passed as an argument. We
then examine how passing a function as an argument can affect the
environment in which the function’s code is executed.</p>
<section id="function-pointers">
<h3>Function Pointers<a class="headerlink" href="#function-pointers" title="Link to this heading"></a></h3>
<p>In some languages, functions can be passed as parameters or return
values but cannot be created within the context of another function.
In these languages, all functions are defined at the top level, and
only a pointer or reference to a function may be used as a value.
Consider the following example in C, a language that provides
function pointers:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">func</span><span class="p">)(</span><span class="kt">int</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="o">--</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="o">++</span><span class="n">array</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">*</span><span class="n">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">array</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">add_one</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="n">apply</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">add_one</span><span class="p">);</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d, %d, %d, %d, %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">apply()</span></code> function takes in an array, its size, and a pointer to
a function that takes in an <code class="docutils literal notranslate"><span class="pre">int</span></code> and returns an <code class="docutils literal notranslate"><span class="pre">int</span></code>. It applies
the function to each element in the array, replacing the original
value with the result. The <code class="docutils literal notranslate"><span class="pre">add_one()</span></code> function is passed as an
argument to <code class="docutils literal notranslate"><span class="pre">apply()</span></code> (C automatically converts a function to a
function pointer), and the result is that each element in <code class="docutils literal notranslate"><span class="pre">A</span></code> has
been incremented.</p>
</section>
<section id="binding-policy">
<span id="id7"></span><h3>Binding Policy<a class="headerlink" href="#binding-policy" title="Link to this heading"></a></h3>
<p>In the code above, there are three environments associated with the
<code class="docutils literal notranslate"><span class="pre">add_one()</span></code> function: its definition environment, the environment
where it was referenced (in <code class="docutils literal notranslate"><span class="pre">main()</span></code>), and the environment where it
was called (in <code class="docutils literal notranslate"><span class="pre">apply()</span></code>). Depending on the semantics of the
language, any of these three environments may be components of the
environment in which the body of <code class="docutils literal notranslate"><span class="pre">add_one()</span></code> is executed.</p>
<p>Recall that in static scope, the code in a function has access to the
names in its definition environment, whereas in dynamic scope, it has
access to the names in the environment of its use. Considering dynamic
scope, is the non-local environment of a function the one where the
function was referenced or the one where it was called? The following
is an example where this distinction is relevant:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">bar</span><span class="p">)())</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">bar</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">baz</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">  </span><span class="n">print</span><span class="p">(</span><span class="n">foo</span><span class="p">(</span><span class="n">baz</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In dynamic scope, a function has access to the environment of its use.
In the example above, however, the result is different depending on if
the use environment of <code class="docutils literal notranslate"><span class="pre">baz()</span></code> is where the function was referenced
or where it was called. In the former case, the non-local environment
of <code class="docutils literal notranslate"><span class="pre">baz()</span></code> is the environment of <code class="docutils literal notranslate"><span class="pre">main()</span></code>, and the <code class="docutils literal notranslate"><span class="pre">x</span></code> in the
body of <code class="docutils literal notranslate"><span class="pre">baz()</span></code> would refer to the one defined in <code class="docutils literal notranslate"><span class="pre">main()</span></code>. This
is known as <em>deep binding</em>. In the latter case, the non-local
environment of <code class="docutils literal notranslate"><span class="pre">baz()</span></code> is the environment of <code class="docutils literal notranslate"><span class="pre">foo()</span></code>, and <code class="docutils literal notranslate"><span class="pre">x</span></code> in
<code class="docutils literal notranslate"><span class="pre">baz()</span></code> would refer to the one defined in <code class="docutils literal notranslate"><span class="pre">foo()</span></code>. This is called
<em>shallow binding</em>. Both approaches are valid, and the binding policy
of a language determines which one is used.</p>
<p>Binding policy can also make a difference when static scope is used in
the case of functions defined locally inside of a recursive function.
However, deep binding is universally used in languages with static
scope, so that the environment established at the time of a function’s
definition is the one the function has access to.</p>
</section>
</section>
<section id="nested-functions">
<h2>Nested Functions<a class="headerlink" href="#nested-functions" title="Link to this heading"></a></h2>
<p>A key feature of functional programming is the ability to define a
function from within another function, allowing the dynamic creation
of a function. In languages with static scoping, such a nested
function has access to its definition environment, and the combination
of a function and its definition environment is called a <em>closure</em>.
Variables used in the nested function but defined in the enclosing
environment are said to be <em>captured</em> by the closure. If a nested
function is returned or otherwise leaks from the enclosing function,
the environment of the enclosing function generally must persist after
the function returns, since bindings within it may be accessed by the
nested function.</p>
<p>As an example, consider the following higher-order function in Python
that returns a nested function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_greater_than</span><span class="p">(</span><span class="n">threshold</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">greater_than</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">threshold</span>

    <span class="k">return</span> <span class="n">greater_than</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">make_greater_than()</span></code> function takes in a threshold value and
constructs a nested function that determines if its input is greater
than the threshold value. The <code class="docutils literal notranslate"><span class="pre">threshold</span></code> variable is located in the
activation record of <code class="docutils literal notranslate"><span class="pre">make_greater_than()</span></code> but is captured by
<code class="docutils literal notranslate"><span class="pre">greater_than()</span></code>. Since the latter is returned, the activation
record must persist so that invocations of <code class="docutils literal notranslate"><span class="pre">greater_than()</span></code> can
access the binding for <code class="docutils literal notranslate"><span class="pre">threshold</span></code>.</p>
<p>Observe that each time <code class="docutils literal notranslate"><span class="pre">make_greater_than()</span></code> is called, a different
instance of <code class="docutils literal notranslate"><span class="pre">greater_than()</span></code> is created with its own enclosing
environment. Thus, different invocations of <code class="docutils literal notranslate"><span class="pre">make_greater_than()</span></code>
result in different functions:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gt3</span> <span class="o">=</span> <span class="n">make_greater_than</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gt30</span> <span class="o">=</span> <span class="n">make_greater_than</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gt3</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gt3</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gt30</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gt30</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p><a class="reference internal" href="#figure-greater-than"><span class="std std-numref">Figure 22</span></a> from <a class="reference external" href="http://www.pythontutor.com/">Python Tutor</a> shows the state
when <code class="docutils literal notranslate"><span class="pre">gt3(2)</span></code> is called.</p>
<figure class="align-center" id="id16">
<span id="figure-greater-than"></span><a class="reference internal image-reference" href="_images/greater_than.svg"><img alt="_images/greater_than.svg" src="_images/greater_than.svg" width="600" /></a>
<figcaption>
<p><span class="caption-number">Figure 22 </span><span class="caption-text">Environment for multiple instances of a nested function.</span><a class="headerlink" href="#id16" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The parent frame of the invocation is that in which <code class="docutils literal notranslate"><span class="pre">threshold</span></code> is
bound to 3, so <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&gt;</span> <span class="pre">threshold</span></code> evaluates to false.</p>
<p>Languages that are not purely functional may allow modification of a
captured variable. For example, the following defines a data
abstraction for a bank account using nested functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_account</span><span class="p">(</span><span class="n">balance</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">balance</span>
        <span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>
        <span class="k">return</span> <span class="n">balance</span>

    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">balance</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">amount</span> <span class="o">&lt;=</span> <span class="n">balance</span><span class="p">:</span>
            <span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span>
            <span class="k">return</span> <span class="n">amount</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">deposit</span><span class="p">,</span> <span class="n">withdraw</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">nonlocal</span></code> statements are required in Python, since it assumes
that assignments are to local variables by default. We can then use
the created functions as follows:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">deposit</span><span class="p">,</span> <span class="n">withdraw</span> <span class="o">=</span> <span class="n">make_account</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">withdraw</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deposit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">90</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">withdraw</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="go">20</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deposit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">70</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deposit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">80</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">withdraw</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deposit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">80</span>
</pre></div>
</div>
<p>We will return to <a class="reference internal" href="data.html#functional-data-abstraction"><span class="std std-ref">data abstraction using functions</span></a> later.</p>
<section id="decorators">
<h3>Decorators<a class="headerlink" href="#decorators" title="Link to this heading"></a></h3>
<p>A common pattern in Python is to transform a function (or class) by
applying a higher-order function to it. Such a higher-order function
is called a <em>decorator</em>, and Python has specific syntax for decorating
functions:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>@&lt;decorator&gt;
def &lt;name&gt;(&lt;parameters&gt;):
    &lt;body&gt;
</pre></div>
</div>
<p>This is largely equivalent to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="n">parameters</span><span class="o">&gt;</span><span class="p">):</span>
    <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">decorator</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>The decorated function’s definition is executed normally, and then the
decorator is called on the function. The result of this invocation is
then bound to the name of the function.</p>
<p>As an example, suppose we wanted to trace when a function is called by
printing out the name of the function as well as its arguments. We
could define a higher-order function that takes in a function and
returns a new nested function that first prints out the name of the
original function and its arguments and then calls it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">tracer</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">args_string</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">args_string</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tracer</span>
</pre></div>
</div>
<p>Here, we make use of variadic arguments to pass any number of
arguments to the original function. (For simplicity, we ignore keyword
arguments.) We can then use decorator syntax to apply this to a
function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@trace</span>
<span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">n</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Now whenever a call to <code class="docutils literal notranslate"><span class="pre">factorial()</span></code> is made, we get a printout of
the arguments:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">factorial</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="go">factorial(5)</span>
<span class="go">factorial(4)</span>
<span class="go">factorial(3)</span>
<span class="go">factorial(2)</span>
<span class="go">factorial(1)</span>
<span class="go">factorial(0)</span>
<span class="go">120</span>
</pre></div>
</div>
<p>Notice that the recursive calls also call the transformed function.
This is because the name <code class="docutils literal notranslate"><span class="pre">factorial</span></code> is now bound to the nested
tracer function in the enclosing environment of <code class="docutils literal notranslate"><span class="pre">factorial()</span></code>, so
looking up the name results in the tracer function rather than the
original one. A side effect of this is that we have <em>mutual recursion</em>
where a set of functions indirectly make recursive calls through each
other. In this case, the tracer calls the original <code class="docutils literal notranslate"><span class="pre">factorial()</span></code>,
which calls the tracer, as shown in the diagram in
<a class="reference internal" href="#figure-trace"><span class="std std-numref">Figure 23</span></a> for <code class="docutils literal notranslate"><span class="pre">factorial(2)</span></code> from <a class="reference external" href="http://www.pythontutor.com/">Python Tutor</a>.</p>
<figure class="align-center" id="id17">
<span id="figure-trace"></span><a class="reference internal image-reference" href="_images/trace.svg"><img alt="_images/trace.svg" src="_images/trace.svg" width="500" /></a>
<figcaption>
<p><span class="caption-number">Figure 23 </span><span class="caption-text">Mutual recursion resulting from decorating a recursive function.</span><a class="headerlink" href="#id17" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
</section>
<section id="lambda-functions">
<span id="lambda-expression"></span><h1>Lambda Functions<a class="headerlink" href="#lambda-functions" title="Link to this heading"></a></h1>
<p>Nested function definitions allow the construction of functions at
runtime, fulfilling one of the requirements for functions to be a
first-class entity. So far, however, we’ve only seen nested function
definitions that are named, introducing a binding into the definition
environment. This is in contrast to other first-class entities, such
as data values, that can be created without being bound to a name.
Just like it can be useful to construct a value without a name, such
as when passing it as an argument or returning it, it can be useful to
construct unnamed functions. These are called <em>anonymous</em> or <em>lambda</em>
functions.</p>
<p>Lambda functions are ubiquitous in functional languages, but many
common imperative languages also provide some form of lambda
functions. The syntax and capabilities differ between different
languages, and we will examine a few representative examples.</p>
<section id="scheme">
<h2>Scheme<a class="headerlink" href="#scheme" title="Link to this heading"></a></h2>
<p>Lambdas are a common construct in the Lisp family of languages, those
languages being primarily functional, and Scheme is no exception. The
<code class="docutils literal notranslate"><span class="pre">lambda</span></code> special form constructs an anonymous function:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">&lt;parameters&gt;</span><span class="p">)</span><span class="w"> </span><span class="nv">&lt;body&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>A function definition using the <code class="docutils literal notranslate"><span class="pre">define</span></code> form can then be considered
a shorthand for a variable definition and a <code class="docutils literal notranslate"><span class="pre">lambda</span></code>:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">&lt;name&gt;</span><span class="w"> </span><span class="nv">&lt;parameters&gt;</span><span class="p">)</span><span class="w"> </span><span class="nv">&lt;body&gt;</span><span class="p">)</span>
<span class="w">  </span><span class="nv">--&gt;</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">&lt;name&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">&lt;parameters&gt;</span><span class="p">)</span><span class="w"> </span><span class="nv">&lt;body&gt;</span><span class="p">))</span>
</pre></div>
</div>
<p>As an example, consider the following function that creates and
returns an anonymous function that adds a given number to its
argument:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">make-adder</span><span class="w"> </span><span class="nv">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This is simpler and more appropriate than an equivalent definition
that only uses <code class="docutils literal notranslate"><span class="pre">define</span></code>:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">make-adder</span><span class="w"> </span><span class="nv">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">adder</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="nv">adder</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We can then call the result of <code class="docutils literal notranslate"><span class="pre">make-adder</span></code> on individual
arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="n">define</span> <span class="n">add3</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">adder</span> <span class="mi">3</span><span class="p">))</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">add3</span> <span class="mi">4</span><span class="p">)</span>
<span class="mi">7</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">add3</span> <span class="mi">5</span><span class="p">)</span>
<span class="mi">8</span>
<span class="o">&gt;</span> <span class="p">((</span><span class="n">make</span><span class="o">-</span><span class="n">adder</span> <span class="mi">4</span><span class="p">)</span> <span class="mi">5</span><span class="p">)</span>
<span class="mi">9</span>
</pre></div>
</div>
<p>Nested functions in Scheme use static scope, so the anonymous function
has access to the variable <code class="docutils literal notranslate"><span class="pre">n</span></code> in its definition environment. It
then adds its own argument <code class="docutils literal notranslate"><span class="pre">x</span></code> to <code class="docutils literal notranslate"><span class="pre">n</span></code>, returning the sum.</p>
<p>Scheme is not purely functional, allowing mutation of variables and
compound data. Nested functions, whether anonymous or not, can modify
variables in their non-local environment. The following function
creates a counter function that returns how many times it has been
called:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">make-counter</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nb">count</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">()</span>
<span class="w">      </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="nb">count</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nb">count</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">      </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="nb">count</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">set!</span></code> form mutates a variable to the given value. We can then
use the <code class="docutils literal notranslate"><span class="pre">make-counter</span></code> function as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="n">define</span> <span class="n">counter</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">counter</span><span class="p">))</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">counter</span><span class="p">)</span>
<span class="mi">0</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">counter</span><span class="p">)</span>
<span class="mi">1</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">counter</span><span class="p">)</span>
<span class="mi">2</span>
</pre></div>
</div>
</section>
<section id="python">
<h2>Python<a class="headerlink" href="#python" title="Link to this heading"></a></h2>
<p>Python supports anonymous functions with the <code class="docutils literal notranslate"><span class="pre">lambda</span></code> expression.
This takes the following form:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">lambda</span> <span class="o">&lt;</span><span class="n">parameters</span><span class="o">&gt;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">body</span> <span class="n">expression</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The syntax of lambda expressions in Python produce a constraint on
anonymous functions that is not present in named nested functions: the
body must be a single expression, and the value of that expression is
automatically the return value of the function. In practice, this
limitation is usually not a problem, since lambdas are often used in
functional contexts where statements and side effects may not be
appropriate.</p>
<p>The following is a definition of the <code class="docutils literal notranslate"><span class="pre">greater_than()</span></code> higher-order
function that uses a lambda:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_greater_than</span><span class="p">(</span><span class="n">threshold</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">threshold</span>
</pre></div>
</div>
<p>As can be seen in this example, simple nested functions that are used
in only a single place can be written more succinctly with a lambda
expression than with a definition statement.</p>
<p>While lambda functions in Python have access to their definition
environment, they are syntactically prevented from directly modifying
bindings in the non-local environment.</p>
</section>
<section id="java">
<h2>Java<a class="headerlink" href="#java" title="Link to this heading"></a></h2>
<p>Java does not allow nested function definitions, but it does have
syntax for what it calls “lambda expressions.” In actuality, this
construct constructs an anonymous class with a method corresponding to
the given parameters and body, and the compiler infers the base type
of this class from the context of its use.</p>
<p>The following example uses a lambda expression to construct a
functor-like object:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">IntPredicate</span><span class="w"> </span><span class="nf">makeGreaterThan</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">threshold</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">threshold</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can then use the result as follows:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">IntPredicate</span><span class="w"> </span><span class="n">gt3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">makeGreaterThan</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">gt3</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span><span class="w">    </span><span class="c1">// prints out false</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">gt3</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span><span class="w">   </span><span class="c1">// prints out true</span>
</pre></div>
</div>
<p>Java allows a lambda to take in any number of arguments, and providing
types for the parameters is optional. The body can be a single
expression or a block containing arbitrary statements.</p>
<p>On the other hand, Java places a significant restriction on lambda
expressions. A lambda can only access variables in its definition
environment that are never reassigned, and it cannot modify them
itself. This is because lambdas are not implemented as closures, but
rather as functor-like objects that store “captured” variables as
members. The following is effectively equivalent to the code above,
but using named classes and methods:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">IntPredicate</span><span class="w"> </span><span class="nf">makeGreaterThan</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">threshold</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">Anonymous</span><span class="p">(</span><span class="n">threshold</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Anonymous</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">IntPredicate</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">Anonymous</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">threshold</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">threshold</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">threshold</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">threshold</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="c">
<h2>C++<a class="headerlink" href="#c" title="Link to this heading"></a></h2>
<p>Like Java, C++ has lambda expressions, but they provide more
functionality than those in Java. A programmer can specify which
variables in the definition environment are captured, and whether they
are captured by value or by reference. The former creates a copy of a
variable, while the latter allows a captured variable to be modified
by the lambda.</p>
<p>The simplest lambda expressions are those that do not capture anything
from the enclosing environment. Such a lambda can be written as a
top-level function instead <a class="footnote-reference brackets" href="#id9" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>, and C++ even allows a captureless
lambda to be converted to a function pointer. For example, the
following code passes a lambda function to a higher-order function
that takes in a function pointer:</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id9" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">3</a><span class="fn-bracket">]</span></span>
<p>A captureless lambda is actually implemented as a functor,
avoiding an indirection when the lambda is invoked without
first converting it to a function pointer.</p>
</aside>
</aside>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">max_element</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">less</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">max_so_far</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">less</span><span class="p">(</span><span class="n">max_so_far</span><span class="p">,</span><span class="w"> </span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">max_so_far</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">max_so_far</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">array</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">max_element</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">                      </span><span class="p">[](</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="w">                      </span><span class="p">})</span>
<span class="w">       </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The code constructs a lambda function that returns true if the first
element is bigger than the second, and passing that to
<code class="docutils literal notranslate"><span class="pre">max_element()</span></code> finds the minimum rather than the maximum element.</p>
<p>Lambdas that capture variables, whether by value or by reference, have
state that is associated with a specific evaluation of a lambda
expression, and this state can differ between different calls to the
enclosing function. As a result, such a lambda is not representable as
a top-level function. Instead, C++ implicitly defines a functor type
for a capturing lambda. Evaluating a capturing lambda expression
constructs an instance of this functor type, with the captured values
and references stored as non-static members. Since the functor type is
implicitly defined, type deduction with the <code class="docutils literal notranslate"><span class="pre">auto</span></code> keyword is
usually used where the type of the functor is required.</p>
<p>The following is an example that uses a lambda to define a greater-than
functor:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">make_greater_than</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">threshold</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="o">=</span><span class="p">](</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">threshold</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">gt3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_greater_than</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">gt3</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">                      </span><span class="c1">// prints 0</span>
<span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">gt3</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">                     </span><span class="c1">// prints 1</span>
<span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">make_greater_than</span><span class="p">(</span><span class="mi">30</span><span class="p">)(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">   </span><span class="c1">// prints 0</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">=</span></code> in the capture list for the lambda specifies that all
variables from the enclosing environment that are used by the lambda
should be captured by value. The code above is equivalent to the
following that explicitly uses a functor:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">GreaterThan</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">GreaterThan</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">threshold_in</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">threshold</span><span class="p">(</span><span class="n">threshold_in</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="p">()(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">threshold</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">threshold</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">auto</span><span class="w"> </span><span class="n">make_greater_than</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">threshold</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">GreaterThan</span><span class="p">(</span><span class="n">threshold</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As indicated in the code above, a variable captured by value is
implicitly qualified as <code class="docutils literal notranslate"><span class="pre">const</span></code>.</p>
<p>An enclosing variable may also be captured by reference. However, a
variable that is captured by reference does <strong>not</strong> have its lifetime
extended. The reasoning for this is twofold. The first, practical
reason is that C++ implementations generally use stack-based
management of automatic variables, and when a function returns, its
activation record on the stack is reclaimed. Requiring that a variable
live past its function invocation prevents activation records from
being managed using a stack. The second, more fundamental reason is
that the RAII (i.e. scope-based resource management) paradigm in C++
requires that when an automatic variable goes out of scope, the
destructor for its corresponding object is run and the object
reclaimed. Relaxing this requirement would result in undesirable
effects similar to those of finalizers in garbage-collected languages.</p>
<p>The end result is that a lambda functor that captures by reference
should not be used past the existence of its enclosing function
invocation. The following counter definition is therefore erroneous:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">make_counter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The lifetime of the <code class="docutils literal notranslate"><span class="pre">count</span></code> variable ends when <code class="docutils literal notranslate"><span class="pre">make_counter()</span></code>
returns, so that calling the lambda functor afterwards erroneously
uses a dead object.</p>
<p>An alternative is to capture <code class="docutils literal notranslate"><span class="pre">count</span></code> by value, which stores a copy
as a member of the lambda, and then mark the lambda as <code class="docutils literal notranslate"><span class="pre">mutable</span></code>.
This removes the implicit <code class="docutils literal notranslate"><span class="pre">const</span></code> qualification from variables
captured by value, allowing them to be modified:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">make_counter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="o">=</span><span class="p">]()</span><span class="w"> </span><span class="k">mutable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This definition is equivalent to the <code class="docutils literal notranslate"><span class="pre">Counter</span></code> functor we defined in
<a class="reference internal" href="#function-objects">Function Objects</a>.</p>
</section>
<section id="common-patterns">
<h2>Common Patterns<a class="headerlink" href="#common-patterns" title="Link to this heading"></a></h2>
<p>We now take a look at some common computational patterns in functional
programming. We will look at how to abstract these patterns as
higher-order functions, as well as how to use them with lambda
functions.</p>
<section id="sequence-patterns">
<h3>Sequence Patterns<a class="headerlink" href="#sequence-patterns" title="Link to this heading"></a></h3>
<p>A number of functional patterns operate over sequences. These patterns
take in a sequence and a function and apply the function to elements
of the sequence, producing a new sequence or value as a result. Since
these are functional patterns, the original sequence is left
unchanged.</p>
<section id="map">
<h4>Map<a class="headerlink" href="#map" title="Link to this heading"></a></h4>
<p>The <em>map</em> pattern takes a sequence and a function and produces a new
sequence that results from applying the function to each element of
the original sequence. For example, the following adds 1 to each
element of a Scheme list:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>
<span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>We can define the <code class="docutils literal notranslate"><span class="pre">map</span></code> higher-order function as follows:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="nv">func</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">null?</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span>
<span class="w">      </span><span class="nv">lst</span>
<span class="w">      </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="p">(</span><span class="nf">func</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">))</span>
<span class="w">            </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="nv">func</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">lst</span><span class="p">)))</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Applying <code class="docutils literal notranslate"><span class="pre">map</span></code> to an empty list results in an empty list. Otherwise,
<code class="docutils literal notranslate"><span class="pre">map</span></code> applies the given function to the first item in the list and
recursively calls <code class="docutils literal notranslate"><span class="pre">map</span></code> on the rest of the list.</p>
<p>Python has a built-in <code class="docutils literal notranslate"><span class="pre">map()</span></code> function that takes in a function and
an iterator and returns an iterator that results from applying the
function to each item in the original iterator.</p>
</section>
<section id="reduce">
<h4>Reduce<a class="headerlink" href="#reduce" title="Link to this heading"></a></h4>
<p>In the <em>reduce</em> pattern, a two-argument function is applied to the
first two items in a sequence, then it is applied to the result and
the next item, then to the result of that and the next item, and so
on. A reduction may be left or right associative, but the former is
more common. <a class="reference internal" href="#figure-reduce"><span class="std std-numref">Figure 24</span></a> illustrates the difference
between left- and right-associative reductions.</p>
<figure class="align-center" id="id18">
<span id="figure-reduce"></span><a class="reference internal image-reference" href="_images/reduce.svg"><img alt="_images/reduce.svg" src="_images/reduce.svg" width="500" /></a>
<figcaption>
<p><span class="caption-number">Figure 24 </span><span class="caption-text">Left-associative and right-associative reductions.</span><a class="headerlink" href="#id18" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Often, if only a single item is in the sequence, that
item is returned without applying the function. Some definitions allow
an initial value to be specified as well for the case in which the
sequence is empty.</p>
<p>The following examples compute the sum and maximum element of a Scheme
list:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">reduce-right</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">))</span>
<span class="mi">10</span>
<span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">reduce-right</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">))</span>
<span class="mi">4</span>
</pre></div>
</div>
<p>We can define a right-associative reduction as follows, which assumes
that the given list has at least one element:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">reduce-right</span><span class="w"> </span><span class="nv">func</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">null?</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">lst</span><span class="p">))</span>
<span class="w">      </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nf">func</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">reduce-right</span><span class="w"> </span><span class="nv">func</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">lst</span><span class="p">)))</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Python includes a left-associative <code class="docutils literal notranslate"><span class="pre">reduce()</span></code> function in the
<code class="docutils literal notranslate"><span class="pre">functools</span></code> module.</p>
</section>
<section id="filter">
<h4>Filter<a class="headerlink" href="#filter" title="Link to this heading"></a></h4>
<p>The <em>filter</em> pattern uses a predicate function to filter items out of
a list. A <em>predicate</em> is a function that takes in a value and returns
true or false. In filter, elements that test true are retained while
those that test false are discarded.</p>
<p>The following example filters out the odd elements from a list:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">filter</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">))</span>
<span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>The following is a definition of <code class="docutils literal notranslate"><span class="pre">filter</span></code>:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">filter</span><span class="w"> </span><span class="nv">pred</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">null?</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span>
<span class="w">      </span><span class="nv">lst</span>
<span class="w">      </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">pred</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">))</span>
<span class="w">          </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">filter</span><span class="w"> </span><span class="nv">pred</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">lst</span><span class="p">)))</span>
<span class="w">          </span><span class="p">(</span><span class="nb">filter</span><span class="w"> </span><span class="nv">pred</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">lst</span><span class="p">))</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Python provides a built-in <code class="docutils literal notranslate"><span class="pre">filter()</span></code> function as well.</p>
</section>
<section id="any">
<h4>Any<a class="headerlink" href="#any" title="Link to this heading"></a></h4>
<p>The <em>any</em> pattern is a higher-order version of <code class="docutils literal notranslate"><span class="pre">or</span></code> (disjunction).
It takes a predicate and applies the predicate to each successive item
in a list, returning the first true result from the predicate. If no
item tests true, then false is returned. Some languages use the name
<em>find</em> for this pattern rather than <em>any</em>.</p>
<p>The following examples search a list for an even value:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">any</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">))</span>
<span class="no">#t</span>
<span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">any</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>
<span class="no">#f</span>
</pre></div>
</div>
<p>A short-circuiting <code class="docutils literal notranslate"><span class="pre">any</span></code> function can be defined as follows:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">any</span><span class="w"> </span><span class="nv">pred</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">null?</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span>
<span class="w">      </span><span class="no">#f</span>
<span class="w">      </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">result</span><span class="w"> </span><span class="p">(</span><span class="nf">pred</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">))))</span>
<span class="w">        </span><span class="p">(</span><span class="k">or</span><span class="w"> </span><span class="nv">result</span>
<span class="w">            </span><span class="p">(</span><span class="nb">any</span><span class="w"> </span><span class="nv">pred</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">lst</span><span class="p">))</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The <em>every</em> pattern can be similarly defined as the higher-order
analogue of conjunction.</p>
</section>
</section>
<section id="composition">
<h3>Composition<a class="headerlink" href="#composition" title="Link to this heading"></a></h3>
<p>Programs often compose functions, applying a function to the result of
applying another function to a value. Wrapping these two function
applications together in a single function enables both operations to
be done with a single call. For example, the following multiplies each
item in a list by three and then adds one:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="p">(</span><span class="nb">compose</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">                </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="nv">x</span><span class="p">)))</span>
<span class="w">       </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">(</span><span class="mi">10</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="mi">22</span><span class="p">)</span>
</pre></div>
</div>
<p>We can define <code class="docutils literal notranslate"><span class="pre">compose</span></code> as follows:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">compose</span><span class="w"> </span><span class="nv">f</span><span class="w"> </span><span class="nv">g</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nf">f</span><span class="w"> </span><span class="p">(</span><span class="nf">g</span><span class="w"> </span><span class="nv">x</span><span class="p">))</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="partial-application-and-currying">
<span id="currying"></span><h3>Partial Application and Currying<a class="headerlink" href="#partial-application-and-currying" title="Link to this heading"></a></h3>
<p>Partial application allows us to specify some arguments to a function
at a different time than the remaining arguments. Supplying <span class="math notranslate nohighlight">\(k\)</span>
arguments to a function that takes in <span class="math notranslate nohighlight">\(n\)</span> arguments results in a
function that takes in <span class="math notranslate nohighlight">\(n-k\)</span> arguments.</p>
<p>As an example, suppose we want to define a function that computes
powers of two. In Python, we can supply 2 as the first argument to the
built-in <code class="docutils literal notranslate"><span class="pre">pow()</span></code> function to produce such a function. We need a
partial-application higher-order function such as the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">partial</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">newfunc</span><span class="p">(</span><span class="o">*</span><span class="n">nargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">nargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">newfunc</span>
</pre></div>
</div>
<p>We can then construct a powers-of-two function as follows:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">power_of_two</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="nb">pow</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">power_of_two</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">power_of_two</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="go">128</span>
</pre></div>
</div>
<p>Python actually provides a more general implementation of
<code class="docutils literal notranslate"><span class="pre">partial()</span></code> that works for keyword arguments as well in the
<code class="docutils literal notranslate"><span class="pre">functools</span></code> module. C++ provides partial application using the
<code class="docutils literal notranslate"><span class="pre">bind()</span></code> template in the <code class="docutils literal notranslate"><span class="pre">&lt;functional&gt;</span></code> header.</p>
<p>A related but distinct concept is <em>currying</em>, which transforms a
function that takes in <span class="math notranslate nohighlight">\(n\)</span> arguments to a sequence of <span class="math notranslate nohighlight">\(n\)</span>
functions that each take in a single argument. For example, the
<code class="docutils literal notranslate"><span class="pre">pow()</span></code> function would be transformed as follows:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">curried_pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">8</span>
</pre></div>
</div>
<p>The curried version of the function takes in a single argument,
returning another function. The latter takes in another argument and
produces the final value. Since the original <code class="docutils literal notranslate"><span class="pre">pow()</span></code> takes in two
arguments, the curried function chain has length two.</p>
<p>We can define currying for two-parameter functions as follows in
Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">curry2</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">curriedA</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">curriedB</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">curriedB</span>

    <span class="k">return</span> <span class="n">curriedA</span>
</pre></div>
</div>
<p>Then we can call <code class="docutils literal notranslate"><span class="pre">curry2(pow)</span></code> to produce a curried version of
<code class="docutils literal notranslate"><span class="pre">pow()</span></code>.</p>
<p>We can also define an “uncurry” operation that takes in a function
that must be applied to a sequence of <span class="math notranslate nohighlight">\(n\)</span> arguments and produce
a single function with <span class="math notranslate nohighlight">\(n\)</span> parameters. The following does so for
a sequence of two arguments:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">uncurry2</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">uncurried</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">a</span><span class="p">)(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">uncurried</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">uncurried_pow</span> <span class="o">=</span> <span class="n">uncurry2</span><span class="p">(</span><span class="n">curried_pow</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uncurried_pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">8</span>
</pre></div>
</div>
<p>Some functional languages, such as Haskell, only permit functions with
a single parameter. Functions that are written to take in more than
one parameter are automatically curried.</p>
</section>
</section>
</section>
<section id="continuations">
<span id="id10"></span><h1>Continuations<a class="headerlink" href="#continuations" title="Link to this heading"></a></h1>
<p>An running program encompasses two types of state: the data that the
program is using and the control state of the program, such as the
stack of active functions and the code locations in each of those
functions. This control state can be represented in the form of a
<em>continuation</em>.</p>
<p>A continuation can be <em>invoked</em> in order to return control to a
previous state. Since a continuation only represents control state,
invoking a continuation does <strong>not</strong> return data to their previous
state. Instead, data retain the values they had at the time the
continuation was invoked. The following is an analogy of invoking a
continuation by <a class="reference external" href="https://groups.google.com/forum/#!msg/perl.perl6.language/-KFNPaLL2yE/_RzO8Fenz7AJ">Luke Palmer</a>:</p>
<blockquote class="epigraph">
<div><p>Say you’re in the kitchen in front of the refrigerator, thinking
about a sandwitch [sic]. You take a continuation right there and
stick it in your pocket. Then you get some turkey and bread out of
the refrigerator and make yourself a sandwitch, which is now sitting
on the counter. You invoke the continuation in your pocket, and you
find yourself standing in front of the refrigerator again, thinking
about a sandwitch. But fortunately, there’s a sandwitch on the
counter, and all the materials used to make it are gone. So you eat
it. :-)</p>
</div></blockquote>
<p>In most non-functional languages, a continuation only exists in
implicit form, and there is a restricted set of operations that can be
done to invoke a continuation. In many functional languages, however,
continuations are first-class entities that can be passed as
parameters and returned from functions. We first examine restricted
forms of continuations before considering the more general,
first-class version.</p>
<section id="restricted-continuations">
<h2>Restricted Continuations<a class="headerlink" href="#restricted-continuations" title="Link to this heading"></a></h2>
<p>Simple forms of control flow, such as conditionals and loops, do not
involve continuations, since they do not return to a previous state of
control. Subroutines and exceptions, on the other hand, do revert
control to a previous state and thus make implicit use of
continuations.</p>
<section id="subroutines">
<h3>Subroutines<a class="headerlink" href="#subroutines" title="Link to this heading"></a></h3>
<p>Subroutines involve transfer of control between a caller and callee.
When a subroutine is called, the control state of the caller must be
saved, so that when the subroutine completes, control can be
transferred back to the caller. Implementations make use of activation
records and call stacks that record the sequence of active calls as
well as information about how to return execution to a previous call.
These data structures represent the control state of a program and
thus constitute a continuation.</p>
<p>Languages restrict how the implicit continuation representing a
caller’s state can be invoked. In some languages, including many
functional languages such as Scheme, the caller’s continuation is
only invoked when the subroutine completes normally. Other languages
have a mechanism to terminate a subroutine early, sometimes called
<em>abrupt termination</em>, and invoke the continuation of the caller. In
imperative languages, this usually takes the form of a <em>return</em>
statement. For example, the following Python function uses a return
to immediately invoke the caller’s continuation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span>   <span class="c1"># invoke caller&#39;s continuation</span>
    <span class="c1"># more code, but not executed</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">baz</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>As with any continuation, invoking a caller’s continuation does not
restore the previous state of data. For example, consider the
following Python code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">outer</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
        <span class="k">nonlocal</span> <span class="n">x</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">inner</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>When the call to <code class="docutils literal notranslate"><span class="pre">inner()</span></code> completes, the continuation of
<code class="docutils literal notranslate"><span class="pre">outer()</span></code> is resumed, but the value of <code class="docutils literal notranslate"><span class="pre">x</span></code> is not restored to its
state before the call to <code class="docutils literal notranslate"><span class="pre">inner()</span></code>. Instead, it retains its modified
value, and the code prints <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<p>A more general concept provided by some languages is a <em>coroutine</em>,
which involves two routines passing control to each other by invoking
each other’s continuation. Coroutines differ from mutual recursion in
that each routine’s control state is resumed when it is invoked rather
than creating a fresh function invocation with its own state.</p>
<p>The following is pseudocode for coroutines that pass control to each
other, with one producing items and the other consuming them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">q</span> <span class="o">:=</span> <span class="n">new</span> <span class="n">queue</span>

<span class="n">coroutine</span> <span class="n">produce</span>
    <span class="n">loop</span>
        <span class="k">while</span> <span class="n">q</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">full</span>
            <span class="n">create</span> <span class="n">some</span> <span class="n">new</span> <span class="n">items</span>
            <span class="n">add</span> <span class="n">the</span> <span class="n">items</span> <span class="n">to</span> <span class="n">q</span>
        <span class="k">yield</span> <span class="n">to</span> <span class="n">consume</span>

<span class="n">coroutine</span> <span class="n">consume</span>
    <span class="n">loop</span>
        <span class="k">while</span> <span class="n">q</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">empty</span>
            <span class="n">remove</span> <span class="n">some</span> <span class="n">items</span> <span class="kn">from</span> <span class="nn">q</span>
            <span class="n">use</span> <span class="n">the</span> <span class="n">items</span>
        <span class="k">yield</span> <span class="n">to</span> <span class="n">produce</span>
</pre></div>
</div>
<p>Both coroutines yield control to the other. Unlike with subroutines,
when a coroutine is passed control, execution resumes from where it
previously paused and in the context of the same environment.</p>
<p>Python provides an implementation of coroutines over a tasking layer,
with several abstractions for passing data between running coroutines
and waiting for completion of an action. The following implements the
producer/consumer model using an <code class="docutils literal notranslate"><span class="pre">asyncio.Queue</span></code> for passing values
between the producer and consumer:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>

<span class="n">q</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>     <span class="c1"># queue capacity of 2</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">produce</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[producer] putting&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[producer] done putting&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">consume</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[consumer] got:&#39;</span><span class="p">,</span> <span class="k">await</span> <span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">produce</span><span class="p">(),</span> <span class="n">consume</span><span class="p">()))</span>
</pre></div>
</div>
<p>The latter two statements start the producer and consumer coroutines
running and wait for their completion. The producer passes control to
the coroutine returned by <code class="docutils literal notranslate"><span class="pre">q.put(i)</span></code>, which places an item into the
queue. Execution will not return to the producer until this completes,
so the producer will be forced to wait if the queue is full. The
consumer extracts items from the queue using the <code class="docutils literal notranslate"><span class="pre">q.get()</span></code>
coroutine, waiting if no items are available. The following is the
output when the code is run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">producer</span><span class="p">]</span> <span class="n">putting</span> <span class="mi">0</span>
<span class="p">[</span><span class="n">producer</span><span class="p">]</span> <span class="n">done</span> <span class="n">putting</span> <span class="mi">0</span>
<span class="p">[</span><span class="n">producer</span><span class="p">]</span> <span class="n">putting</span> <span class="mi">1</span>
<span class="p">[</span><span class="n">producer</span><span class="p">]</span> <span class="n">done</span> <span class="n">putting</span> <span class="mi">1</span>
<span class="p">[</span><span class="n">producer</span><span class="p">]</span> <span class="n">putting</span> <span class="mi">2</span>
<span class="p">[</span><span class="n">consumer</span><span class="p">]</span> <span class="n">got</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">[</span><span class="n">consumer</span><span class="p">]</span> <span class="n">got</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="n">producer</span><span class="p">]</span> <span class="n">done</span> <span class="n">putting</span> <span class="mi">2</span>
<span class="p">[</span><span class="n">producer</span><span class="p">]</span> <span class="n">putting</span> <span class="mi">3</span>
<span class="p">[</span><span class="n">producer</span><span class="p">]</span> <span class="n">done</span> <span class="n">putting</span> <span class="mi">3</span>
<span class="p">[</span><span class="n">producer</span><span class="p">]</span> <span class="n">putting</span> <span class="mi">4</span>
<span class="p">[</span><span class="n">consumer</span><span class="p">]</span> <span class="n">got</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">[</span><span class="n">consumer</span><span class="p">]</span> <span class="n">got</span><span class="p">:</span> <span class="mi">3</span>
<span class="p">[</span><span class="n">producer</span><span class="p">]</span> <span class="n">done</span> <span class="n">putting</span> <span class="mi">4</span>
<span class="p">[</span><span class="n">consumer</span><span class="p">]</span> <span class="n">got</span><span class="p">:</span> <span class="mi">4</span>
</pre></div>
</div>
<p>This demonstrates how execution passes back and forth between the
consumer and producer coroutines.</p>
</section>
<section id="exceptions">
<h3>Exceptions<a class="headerlink" href="#exceptions" title="Link to this heading"></a></h3>
<p>Exceptions also cause control to be passed from one execution state to
an earlier one, but unlike returning from a subroutine, the receiver
of control need not be the direct caller of a function. Upon entering
a <code class="docutils literal notranslate"><span class="pre">try</span></code> block, the control state is saved and the associated
exception handlers are added to a stack of active handlers. When an
exception is raised, the handler stack is searched for a handler that
can accommodate the exception type, the continuation of the associated
function is invoked, and the handler code is executed.</p>
<p>As a concrete example, consider the following Python code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exception&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">baz</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">baz</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">Exception</span>

<span class="n">foo</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>When the <code class="docutils literal notranslate"><span class="pre">try</span></code> statement in the invocation of <code class="docutils literal notranslate"><span class="pre">foo(3)</span></code> is reached.
the associated exception handler is added to the handler stack.
Execution proceeds to the call to <code class="docutils literal notranslate"><span class="pre">bar(3)</span></code> and then to <code class="docutils literal notranslate"><span class="pre">baz(3)</span></code>,
which raises an exception. This passes control to the first exception
handler that can handle an exception of type <code class="docutils literal notranslate"><span class="pre">Exception</span></code>, which was
located in the call to <code class="docutils literal notranslate"><span class="pre">foo(3)</span></code>. Thus, the latter’s continuation is
invoked and the exception handler is run.</p>
<p>The specific mechanisms used to provide exceptions vary between
languages and implementations. Some languages don’t incorporate
exceptions directly but provide a control mechanism that enables an
exception mechanism to be built on top of it. For example, the C
standard library header <code class="docutils literal notranslate"><span class="pre">setjmp.h</span></code> defines a <code class="docutils literal notranslate"><span class="pre">setjmp()</span></code> function
that saves the execution state of a function, and a corresponding
<code class="docutils literal notranslate"><span class="pre">longjmp()</span></code> function that restores the state at the time of the call
to <code class="docutils literal notranslate"><span class="pre">setjmp()</span></code>. Exceptions can also be implemented with first-class
continuations, as we will see below.</p>
</section>
<section id="generators">
<h3>Generators<a class="headerlink" href="#generators" title="Link to this heading"></a></h3>
<p>A <em>generator</em> is a generalization of a subroutine, allowing its
execution to be paused and later resumed. A subroutine is always
executed from its entry point, and every entry into a subroutine
creates a new activation record. On the other hand, a generator can
suspend its execution, and the programmer can resume execution of the
generator at the point where its execution state was suspended and
using the same activation record. Thus, the paused state of a
generator is a form of continuation.</p>
<p>Generators are usually used to write iterators that compute their
values lazily. When a generator computes an item, it <em>yields</em> the item
to its caller by invoking the continuation of the caller, much like a
subroutine. Upon resumption of the generator, the next value is
computed and yielded to its caller, which need not be the same
function as the previous caller.</p>
<p>The following is a generator in Python that produces an infinite
sequence of natural numbers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">naturals</span><span class="p">():</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">num</span>
        <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Generators in Python implement the same interface as an iterator, so
the next item can be obtained by calling the <code class="docutils literal notranslate"><span class="pre">next()</span></code> function on a
generator:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">numbers</span> <span class="o">=</span> <span class="n">naturals</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
<span class="go">2</span>
</pre></div>
</div>
<p>We can use a generator to represent a range, computing each value as
the generator is resumed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">range2</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">start</span>
        <span class="n">start</span> <span class="o">+=</span> <span class="n">step</span>
</pre></div>
</div>
<p>The sequence of values produced by this generator is finite, and after
the last value is produced and the body of <code class="docutils literal notranslate"><span class="pre">range2()</span></code> exits, a
<code class="docutils literal notranslate"><span class="pre">StopIteration</span></code> exception is automatically raised:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">values</span> <span class="o">=</span> <span class="n">range2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<span class="go">6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<span class="go">9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">StopIteration</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">StopIteration</span></code> is used by the Python <code class="docutils literal notranslate"><span class="pre">for</span></code> loop to determine
the end of an iterator:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">range2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">0</span>
<span class="go">3</span>
<span class="go">6</span>
<span class="go">9</span>
</pre></div>
</div>
<p>As another example, we can define a unary version of the built-in
<code class="docutils literal notranslate"><span class="pre">map</span></code> using a generator:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">map_unary</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">func</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">map_unary</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
<span class="go">&lt;generator object map_unary at 0x1032f3f40&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">map_unary</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">]))</span>
<span class="go">[2, 5, -2, 8]</span>
</pre></div>
</div>
<p>The built-in <code class="docutils literal notranslate"><span class="pre">map</span></code> is actually variadic, applying an <span class="math notranslate nohighlight">\(n\)</span>-ary
function to items taken from <span class="math notranslate nohighlight">\(n\)</span> iterables:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">5</span>
<span class="go">7</span>
<span class="go">9</span>
</pre></div>
</div>
<p>As can be seen from this example, <code class="docutils literal notranslate"><span class="pre">map</span></code> stops when the shortest
input iterable is exhausted. We can attempt to write a variadic
generator similar to <code class="docutils literal notranslate"><span class="pre">map</span></code>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">map_variadic</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">iterables</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">iterators</span> <span class="o">=</span> <span class="p">[</span><span class="nb">iter</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">iterables</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">iterables</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iterators</span><span class="p">)):</span>
<span class="gp">... </span>            <span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iterators</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">items</span><span class="p">)</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>We start by obtaining an iterator from each iterable, and then
constructing a list that will hold an element from each iterator,
initialized with dummy zero values. We follow this with an infinite
loop that obtains the next item from each iterator, storing it in the
list, invoking <code class="docutils literal notranslate"><span class="pre">func</span></code> on these items, and yielding the result. When
the shortest iterator is exhausted, invoking <code class="docutils literal notranslate"><span class="pre">next()</span></code> on it will
raise a <code class="docutils literal notranslate"><span class="pre">StopIteration</span></code>, and our intent was for this to end the
<code class="docutils literal notranslate"><span class="pre">map_variadic()</span></code> generator as well. Unfortunately, Python does not
allow a <code class="docutils literal notranslate"><span class="pre">StopIteration</span></code> to be propagated out of a generator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">map_variadic</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">)))</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">6</span>, in <span class="n">map_variadic</span>
<span class="gr">StopIteration</span>

<span class="gt">The above exception was the direct cause of the following exception:</span>

<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">RuntimeError</span>: <span class="n">generator raised StopIteration</span>
</pre></div>
</div>
<p>Instead, a generator is required to terminate normally or with a
<code class="docutils literal notranslate"><span class="pre">return</span></code> when it is complete. Thus, we need to catch the
<code class="docutils literal notranslate"><span class="pre">StopIteration</span></code> and then exit:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">map_variadic</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">iterables</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">iterators</span> <span class="o">=</span> <span class="p">[</span><span class="nb">iter</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">iterables</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">iterables</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iterators</span><span class="p">)):</span>
<span class="gp">... </span>                <span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iterators</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="gp">... </span>            <span class="k">yield</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">items</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">pass</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>Here, we’ve used a dummy <code class="docutils literal notranslate"><span class="pre">pass</span></code> statement in the <code class="docutils literal notranslate"><span class="pre">except</span></code> clause,
since execution will proceed to the end of the generator body and
exit. It would be equally valid to use a <code class="docutils literal notranslate"><span class="pre">return</span></code> statement instead.
The generator now works as intended:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">map_variadic</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">)))</span>
<span class="go">[5, 7, 9]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> statement can be used to delegate to another
generator (or iterator). The following is a definition of a
<code class="docutils literal notranslate"><span class="pre">positives()</span></code> generator that delegates to an instance of
<code class="docutils literal notranslate"><span class="pre">naturals()</span></code>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">positives</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">numbers</span> <span class="o">=</span> <span class="n">naturals</span><span class="p">()</span>
<span class="gp">... </span>    <span class="nb">next</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>       <span class="c1"># discard 0</span>
<span class="gp">... </span>    <span class="k">yield from</span> <span class="n">numbers</span>  <span class="c1"># yield the remaining items in numbers</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">numbers</span> <span class="o">=</span> <span class="n">positives</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
<span class="go">3</span>
</pre></div>
</div>
<p>We construct a <code class="docutils literal notranslate"><span class="pre">naturals()</span></code> generator, discard the initial 0, and
then use <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> to produce the remaining items from the
<code class="docutils literal notranslate"><span class="pre">naturals()</span></code> generator.</p>
<p>Python also has generator expressions, similar to list comprehensions,
that succinctly produce a generator. The following produces a
generator of negative integers from <code class="docutils literal notranslate"><span class="pre">naturals()</span></code>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">negatives</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">naturals</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">negatives</span><span class="p">)</span>
<span class="go">-1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">negatives</span><span class="p">)</span>
<span class="go">-2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">negatives</span><span class="p">)</span>
<span class="go">-3</span>
</pre></div>
</div>
<p>As with list comprehensions, the filtering conditional is optional in
a generator expression.</p>
<p>Generators are also called <em>semicoroutines</em>, since they involve a
standard routine that passes control to a resumable routine. Unlike a
coroutine, however, a generator can only return control to its caller,
while a full coroutine can pass control to any other coroutine.</p>
</section>
</section>
<section id="first-class-continuations">
<h2>First-Class Continuations<a class="headerlink" href="#first-class-continuations" title="Link to this heading"></a></h2>
<p>In some languages, continuations are first-class entities, allowing
the current control state to be saved in an explicit data structure,
passed as a parameter, and invoked from arbitrary locations.
First-class continuations can be used to emulate any of the restricted
forms of continuations above. Depending on the language, it may only
be permitted to invoke a continuation once, or a continuation may be
resumed any number of times.</p>
<p>In Scheme, the <code class="docutils literal notranslate"><span class="pre">call-with-current-continuation</span></code> procedure, often
abbreviated as <code class="docutils literal notranslate"><span class="pre">call/cc</span></code>, creates a continuation object representing
the current control state. The <code class="docutils literal notranslate"><span class="pre">call/cc</span></code> procedure must be passed an
argument:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">call-with-current-continuation</span><span class="w"> </span><span class="nv">&lt;procedure&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">&lt;procedure&gt;</span></code> must be a Scheme procedure that takes an
argument, and <code class="docutils literal notranslate"><span class="pre">call/cc</span></code> invokes this procedure with the newly
created continuation object as the argument. The called procedure may
use the continuation like any other data item, including discarding
it, saving it in a data structure, and returning it, as well as
invoking it. For example, in the following code, the procedure
discards the continuation and returns a value normally:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">     </span><span class="p">(</span><span class="nb">call/cc</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">cc</span><span class="p">)</span>
<span class="w">                </span><span class="mi">3</span>
<span class="w">              </span><span class="p">)</span>
<span class="w">     </span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="mi">4</span>
</pre></div>
</div>
<p>The continuation object constructed by the invocation of <code class="docutils literal notranslate"><span class="pre">call/cc</span></code>
above represents the following execution state:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">&lt;value&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">&lt;value&gt;</span></code> replaces the call to <code class="docutils literal notranslate"><span class="pre">call/cc</span></code>, and it will be
replaced by the value with which the continuation is invoked.</p>
<p>If the procedure invoked by <code class="docutils literal notranslate"><span class="pre">call/cc</span></code> returns a value normally, the
invocation of <code class="docutils literal notranslate"><span class="pre">call/cc</span></code> evaluates to that same value, the same
behavior as a standard function call. In the example above, the
procedure returns the value 3, which replaces the call to <code class="docutils literal notranslate"><span class="pre">call/cc</span></code>,
resulting in a final value of 4.</p>
<p>On the other hand, if the continuation created by <code class="docutils literal notranslate"><span class="pre">call/cc</span></code> is
invoked, then control resumes at the location of the <code class="docutils literal notranslate"><span class="pre">call/cc</span></code>. A
continuation must be passed a value when it is invoked, and the
<code class="docutils literal notranslate"><span class="pre">call/cc</span></code> evaluates to that value:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">     </span><span class="p">(</span><span class="nb">call/cc</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">cc</span><span class="p">)</span>
<span class="w">                </span><span class="p">(</span><span class="nf">cc</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="w">                </span><span class="mi">3</span>
<span class="w">              </span><span class="p">)</span>
<span class="w">     </span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="mi">6</span>
</pre></div>
</div>
<p>In the code above, the continuation represents the same execution
state of <code class="docutils literal notranslate"><span class="pre">(+</span> <span class="pre">1</span> <span class="pre">&lt;value&gt;)</span></code>. The function argument of <code class="docutils literal notranslate"><span class="pre">call/cc</span></code>
invokes the continuation with value 5, causing execution to
immediately resume at the point where <code class="docutils literal notranslate"><span class="pre">call/cc</span></code> is called, with the
value 5 replacing the call to <code class="docutils literal notranslate"><span class="pre">call/cc</span></code>, as if it were a standard
function call that produced the given value. This results in the
execution <code class="docutils literal notranslate"><span class="pre">(+</span> <span class="pre">1</span> <span class="pre">5)</span></code>, resulting in a final value of 6.</p>
<p>More interesting behavior can occur when a continuation is saved in a
variable or data structure. Consider the following:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">var</span>
<span class="w">    </span><span class="p">(</span><span class="nb">call/cc</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">cc</span><span class="p">)</span>
<span class="w">               </span><span class="nv">cc</span>
<span class="w">             </span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
</pre></div>
</div>
<p>The procedure called by <code class="docutils literal notranslate"><span class="pre">call/cc</span></code> returns the continuation, so the
<code class="docutils literal notranslate"><span class="pre">call/cc</span></code> invocation evaluates to the continuation, which is then
bound to <code class="docutils literal notranslate"><span class="pre">var</span></code>. The continuation itself represents the execution:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">var</span><span class="w"> </span><span class="nv">&lt;value&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can bind another variable to the same object:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">cont</span><span class="w"> </span><span class="nv">var</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can use this new variable to invoke the continuation:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">cont</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w">   </span><span class="c1">; executes (define var 3)</span>
<span class="nb">&gt;</span><span class="w"> </span><span class="nv">var</span>
<span class="mi">3</span>
<span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">cont</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w">   </span><span class="c1">; executes (define var 4)</span>
<span class="nb">&gt;</span><span class="w"> </span><span class="nv">var</span>
<span class="mi">4</span>
</pre></div>
</div>
<p>Invoking the continuation with a value causes evaluation to resume at
the <code class="docutils literal notranslate"><span class="pre">call/cc</span></code>, with the given value replacing the <code class="docutils literal notranslate"><span class="pre">call/cc</span></code>. Thus,
invoking <code class="docutils literal notranslate"><span class="pre">cont</span></code> with the value 3 results in the following:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">var</span>
<span class="w">  </span><span class="p">(</span><span class="nb">call/cc</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">cc</span><span class="p">)</span>
<span class="w">             </span><span class="nv">cc</span>
<span class="w">           </span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
<span class="w">  </span><span class="nv">--&gt;</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">var</span><span class="w"> </span><span class="nv">&lt;value&gt;</span><span class="p">)</span>
<span class="w">  </span><span class="nv">--&gt;</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">var</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Thus, <code class="docutils literal notranslate"><span class="pre">var</span></code> is bound to 3. If we invoke <code class="docutils literal notranslate"><span class="pre">cont</span></code> with 4, we get:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">var</span>
<span class="w">  </span><span class="p">(</span><span class="nb">call/cc</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">cc</span><span class="p">)</span>
<span class="w">             </span><span class="nv">cc</span>
<span class="w">           </span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
<span class="w">  </span><span class="nv">--&gt;</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">var</span><span class="w"> </span><span class="nv">&lt;value&gt;</span><span class="p">)</span>
<span class="w">  </span><span class="nv">--&gt;</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">var</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>The result is that <code class="docutils literal notranslate"><span class="pre">var</span></code> is now bound to 4.</p>
<p>As a more complex example, consider the following definition of a
<code class="docutils literal notranslate"><span class="pre">factorial</span></code> procedure:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">cont</span><span class="w"> </span><span class="o">&#39;</span><span class="p">())</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">factorial</span><span class="w"> </span><span class="nv">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nb">call/cc</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">cc</span><span class="p">)</span>
<span class="w">                 </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="nv">cont</span><span class="w"> </span><span class="nv">cc</span><span class="p">)</span>
<span class="w">                 </span><span class="mi">1</span>
<span class="w">               </span><span class="p">)</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="p">(</span><span class="nf">factorial</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The base case is a call to <code class="docutils literal notranslate"><span class="pre">call/cc</span></code>. Then when <code class="docutils literal notranslate"><span class="pre">(factorial</span> <span class="pre">3)</span></code> is
called, the execution state when the base case is reached is:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">&lt;value&gt;</span><span class="p">)))</span>
</pre></div>
</div>
<p>As before, <code class="docutils literal notranslate"><span class="pre">&lt;value&gt;</span></code> represents the call to <code class="docutils literal notranslate"><span class="pre">call/cc</span></code>. The
argument to <code class="docutils literal notranslate"><span class="pre">call/cc</span></code> sets the global variable <code class="docutils literal notranslate"><span class="pre">cont</span></code> to refer to
the newly created continuation and then evaluates normally to 1. The
value 1 thus replaces the <code class="docutils literal notranslate"><span class="pre">call/cc</span></code>, resulting in a final value of
6:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">factorial</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="mi">6</span>
</pre></div>
</div>
<p>If we then invoke the continuation with the value 3, the 3 replaces
the <code class="docutils literal notranslate"><span class="pre">call/cc</span></code> in the execution state represented by the
continuation:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">cont</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w">   </span><span class="c1">; executes (* 3 (* 2 (* 1 3)))</span>
<span class="mi">18</span>
</pre></div>
</div>
<p>If we call <code class="docutils literal notranslate"><span class="pre">(factorial</span> <span class="pre">5)</span></code>, <code class="docutils literal notranslate"><span class="pre">cont</span></code> is modified to refer to a
continuation representing the execution:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">&lt;value&gt;</span><span class="p">)))))</span>
</pre></div>
</div>
<p>Invoking the continuation on 4 then results in 480:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">factorial</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="mi">120</span>
<span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">cont</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w">   </span><span class="c1">; executes (* 5 (* 4 (* 3 (* 2 (* 1 4)))))</span>
<span class="mi">480</span>
</pre></div>
</div>
<section id="signaling-errors">
<h3>Signaling Errors<a class="headerlink" href="#signaling-errors" title="Link to this heading"></a></h3>
<p>We can use first-class continuations to implement a basic mechanism
for aborting a computation and signaling an error. We begin with a
simple procedure to print an error message:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">report-error</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">begin</span><span class="w"> </span><span class="p">(</span><span class="nb">display</span><span class="w"> </span><span class="s">&quot;Error: &quot;</span><span class="p">)</span>
<span class="w">         </span><span class="p">(</span><span class="nb">display</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
<span class="w">         </span><span class="p">(</span><span class="nb">newline</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This procedure expects to be called with a message string, and it
prints out <code class="docutils literal notranslate"><span class="pre">Error:</span></code> followed by the message to standard out.
However, invoking the procedure does not abort the computation in the
caller. Thus, if we encounter an error in a larger computation,
invoking <code class="docutils literal notranslate"><span class="pre">report-error</span></code> causes a message to print but continues
where the computation left off. The following is an example:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">inverse</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nf">report-error</span><span class="w"> </span><span class="s">&quot;0 has no inverse&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nb">/</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">inverse</span></code> procedure reports an error if the argument <code class="docutils literal notranslate"><span class="pre">x</span></code> is
zero. However, it still returns the (undefined) result of calling
<code class="docutils literal notranslate"><span class="pre">report-error</span></code> to the caller of <code class="docutils literal notranslate"><span class="pre">inverse</span></code>. This can result in an
error at the interpreter level:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt; (+ (inverse 0) 1)
Error: 0 has no inverse
+: contract violation
  expected: number?
  given: #&lt;void&gt;
  argument position: 1st
  other arguments...:
   1
  context...:
    [context elided]
</pre></div>
</div>
<p>In this Scheme implementation, the <code class="docutils literal notranslate"><span class="pre">newline</span></code> procedure returns a
special <code class="docutils literal notranslate"><span class="pre">#void</span></code> value, which gets returned by <code class="docutils literal notranslate"><span class="pre">report-error</span></code> and
then by <code class="docutils literal notranslate"><span class="pre">inverse</span></code>. The caller of <code class="docutils literal notranslate"><span class="pre">inverse</span></code> then attempts to add 1
to this result, resulting in an interpreter error.</p>
<p>In order to abort the computation entirely once an error has been
signaled, we can make use of a continuation. We arrange for the
continuation to save the control state at the top level of a program.
but with a following invocation to <code class="docutils literal notranslate"><span class="pre">report-error</span></code> if an error
message is provided:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">error-continuation</span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">message</span><span class="w"> </span><span class="p">(</span><span class="nb">call/cc</span>
<span class="w">                   </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">c</span><span class="p">)</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span>
<span class="w">                 </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">       </span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">string?</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
<span class="w">        </span><span class="p">(</span><span class="nf">report-error</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="nv">message</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Here, the call to <code class="docutils literal notranslate"><span class="pre">call/cc</span></code> saves the control state with the program
about to bind the name <code class="docutils literal notranslate"><span class="pre">message</span></code> within a <code class="docutils literal notranslate"><span class="pre">let</span></code> to the result of
invoking the continuation. In the initial computation, the
continuation object is passed to the <code class="docutils literal notranslate"><span class="pre">lambda</span></code>, which immediately
returns it. The call to <code class="docutils literal notranslate"><span class="pre">call/cc</span></code> evaluates to this value, so
<code class="docutils literal notranslate"><span class="pre">message</span></code> is bound to the continuation object itself, and the body
of the <code class="docutils literal notranslate"><span class="pre">let</span></code> is evaluated. This checks if <code class="docutils literal notranslate"><span class="pre">message</span></code> is a string,
calling <code class="docutils literal notranslate"><span class="pre">report-error</span></code> if this is the case. The <code class="docutils literal notranslate"><span class="pre">let</span></code> as a whole
evaluates to the value of <code class="docutils literal notranslate"><span class="pre">message</span></code>, which is then bound to
<code class="docutils literal notranslate"><span class="pre">error-continuation</span></code> in the global frame.</p>
<p>If we invoke <code class="docutils literal notranslate"><span class="pre">error-continuation</span></code> again, execution will resume at
the point of binding <code class="docutils literal notranslate"><span class="pre">message</span></code>, and it will eventually result in
<code class="docutils literal notranslate"><span class="pre">error-continuation</span></code> being rebound to something other than the
continuation object. To avoid losing the continuation, we can bind
another name to it:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nb">error</span><span class="w"> </span><span class="nv">error-continuation</span><span class="p">)</span>
</pre></div>
</div>
<p>Now even if <code class="docutils literal notranslate"><span class="pre">error-continuation</span></code> is rebound, the name <code class="docutils literal notranslate"><span class="pre">error</span></code>
still refers to the continuation object.</p>
<p>If we invoke <code class="docutils literal notranslate"><span class="pre">error</span></code> with a string, the continuation is invoked with
that value, and the value is plugged into where the continuation was
created. Thus, <code class="docutils literal notranslate"><span class="pre">message</span></code> is bound to the string, and the body of the
<code class="docutils literal notranslate"><span class="pre">let</span></code> is evaluated. Since <code class="docutils literal notranslate"><span class="pre">message</span></code> is a string, <code class="docutils literal notranslate"><span class="pre">report-error</span></code>
is called, printing an error message. The let evaluates to the message
string, which is then bound to the name <code class="docutils literal notranslate"><span class="pre">error-continuation</span></code> in the
global frame. At this point, execution has reached the top level, so
computation is completed without causing an error in the interpreter.</p>
<p>If we repeat our previous example, but invoking <code class="docutils literal notranslate"><span class="pre">error</span></code> rather than
<code class="docutils literal notranslate"><span class="pre">report-error</span></code>, we get the following:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">inverse</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nb">error</span><span class="w"> </span><span class="s">&quot;0 has no inverse&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nb">/</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>

<span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="nf">inverse</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="nv">Error:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">has</span><span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">inverse</span>
</pre></div>
</div>
<p>We no longer have an error reported by the interpreter itself.</p>
</section>
<section id="call-and-return">
<h3>Call and Return<a class="headerlink" href="#call-and-return" title="Link to this heading"></a></h3>
<p>First-class continuations can be used to emulate the more restricted
control constructs provided by imperative languages. For instance,
Scheme does not provide a specific mechanism that allows a procedure
to terminate abruptly, returning a value to the caller. However, we
can emulate call and return, including abrupt returns, with
continuations. We do so by explicitly representing the call stack in a
data structure that provides push and pop operations:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">call-stack</span><span class="w"> </span><span class="o">&#39;</span><span class="p">())</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">push-call</span><span class="w"> </span><span class="nv">call</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="nv">call-stack</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="nv">call</span><span class="w"> </span><span class="nv">call-stack</span><span class="p">))</span>
<span class="p">)</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">pop-call</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">caller</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">call-stack</span><span class="p">)))</span>
<span class="w">     </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="nv">call-stack</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">call-stack</span><span class="p">))</span>
<span class="w">     </span><span class="nv">caller</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We will use this call stack to store a procedure’s continuation when
it calls another procedure. A return just pops a continuation off the
stack and invokes it with the given return value:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">return</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
<span class="w">  </span><span class="p">((</span><span class="nf">pop-call</span><span class="p">)</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We then provide a mechanism for saving a caller’s continuation, by
pushing it onto the call stack, and invoking the callee. For
simplicity, we restrict ourselves to single-argument functions here,
but this can be generalized using Scheme’s variadic arguments.</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">call</span><span class="w"> </span><span class="nv">func</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">call-with-current-continuation</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">cc</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">(</span><span class="nf">push-call</span><span class="w"> </span><span class="nv">cc</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">(</span><span class="nf">func</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">                                  </span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We can then write procedures that use the call stack to terminate
abruptly:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">foo</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&lt;=</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nf">return</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w">             </span><span class="c1">; return x if &lt;= 10</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">y</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">10</span><span class="p">)))</span>
<span class="w">    </span><span class="p">(</span><span class="nf">return</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="p">(</span><span class="nb">/</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)))</span><span class="w">   </span><span class="c1">; otherwise return x + x / (x - 10)</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nf">some</span><span class="w"> </span><span class="nv">more</span><span class="w"> </span><span class="nv">stuff</span><span class="w"> </span><span class="nv">here</span><span class="p">)</span><span class="w">     </span><span class="c1">; control never reaches here</span>
<span class="p">)</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">bar</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nf">return</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="p">(</span><span class="nf">call</span><span class="w"> </span><span class="nv">foo</span><span class="w"> </span><span class="nv">x</span><span class="p">)))</span><span class="w">  </span><span class="c1">; call foo and return the negation</span>
<span class="w">  </span><span class="p">(</span><span class="nf">dead</span><span class="w"> </span><span class="nv">code</span><span class="p">)</span><span class="w">                </span><span class="c1">; control never reaches here</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We can then call <code class="docutils literal notranslate"><span class="pre">foo</span></code> and <code class="docutils literal notranslate"><span class="pre">bar</span></code>:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="nf">call</span><span class="w"> </span><span class="nv">foo</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>
<span class="mi">4</span>
<span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="nf">call</span><span class="w"> </span><span class="nv">foo</span><span class="w"> </span><span class="mi">20</span><span class="p">))</span>
<span class="mi">23</span>
<span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="nf">call</span><span class="w"> </span><span class="nv">bar</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>
<span class="mi">-1</span>
<span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="nf">call</span><span class="w"> </span><span class="nv">bar</span><span class="w"> </span><span class="mi">20</span><span class="p">))</span>
<span class="mi">-20</span>
</pre></div>
</div>
</section>
<section id="id11">
<h3>Exceptions<a class="headerlink" href="#id11" title="Link to this heading"></a></h3>
<p>We can simulate exception handling with a handler stack, using the
same approach as call and return above. The following is a complete
implementation:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">handler-stack</span><span class="w"> </span><span class="o">&#39;</span><span class="p">())</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">push-handler</span><span class="w"> </span><span class="nv">handler</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="nv">handler-stack</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="nv">handler</span><span class="w"> </span><span class="nv">handler-stack</span><span class="p">))</span>
<span class="p">)</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">pop-handler</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">handler</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">handler-stack</span><span class="p">)))</span>
<span class="w">    </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="nv">handler-stack</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">handler-stack</span><span class="p">))</span>
<span class="w">    </span><span class="nv">handler</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">exception-state</span><span class="w"> </span><span class="no">#f</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">set-exception</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="nv">exception-state</span><span class="w"> </span><span class="no">#t</span><span class="p">)</span>
<span class="p">)</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">clear-exception</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="nv">exception-state</span><span class="w"> </span><span class="no">#f</span><span class="p">)</span>
<span class="w">  </span><span class="nv">x</span>
<span class="p">)</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">throw</span><span class="w"> </span><span class="nv">exception</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nf">set-exception</span><span class="p">)</span>
<span class="w">  </span><span class="p">((</span><span class="nf">pop-handler</span><span class="p">)</span><span class="w"> </span><span class="nv">exception</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">try</span><span class="w"> </span><span class="nv">func</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">handler_func</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">result</span><span class="w"> </span><span class="p">(</span><span class="nb">call-with-current-continuation</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">cc</span><span class="p">)</span>
<span class="w">                                                  </span><span class="p">(</span><span class="nf">push-handler</span><span class="w"> </span><span class="nv">cc</span><span class="p">)</span>
<span class="w">                                                  </span><span class="p">(</span><span class="nf">func</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">                                                </span><span class="p">)</span>
<span class="w">                 </span><span class="p">)</span>
<span class="w">         </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">exception-state</span>
<span class="w">        </span><span class="p">(</span><span class="nf">clear-exception</span><span class="w"> </span><span class="p">(</span><span class="nf">handler_func</span><span class="w"> </span><span class="nv">result</span><span class="p">))</span>
<span class="w">        </span><span class="nv">result</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We can then define functions that use exceptions:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">foo</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nb">throw</span><span class="w"> </span><span class="s">&quot;invalid argument: 0</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nb">/</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">bar</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="nf">foo</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">baz</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nf">try</span><span class="w"> </span><span class="nv">bar</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">exception</span><span class="p">)</span>
<span class="w">               </span><span class="p">(</span><span class="nb">display</span><span class="w"> </span><span class="nv">exception</span><span class="p">)</span>
<span class="w">               </span><span class="o">&#39;</span><span class="p">()</span>
<span class="w">             </span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Now we can invoke <code class="docutils literal notranslate"><span class="pre">baz</span></code> with a valid and an erroneous argument:</p>
<div class="highlight-scheme notranslate"><div class="highlight"><pre><span></span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">baz</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="mi">5</span>
<span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">baz</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="nv">illegal</span><span class="w"> </span><span class="nv">argument:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">()</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="foundations.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="theory.html" class="btn btn-neutral float-right" title="Lambda Calculus" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016, Amir Kamil, licensed under the Creative Commons Attribution-ShareAlike 4.0 International license.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org/">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>

<!-- Mirrored from eecs390.github.io/notes/functional.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 19 Mar 2024 18:15:43 GMT -->
</html>